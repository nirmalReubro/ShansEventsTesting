/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { ChangeDetectorRef, Component, ElementRef, EventEmitter, HostListener, Input, Output, QueryList, ViewChild, ViewChildren } from '@angular/core';
import { ImageService } from '../services/image.service';
import { HttpClient } from '@angular/common/http';
var GalleryComponent = /** @class */ (function () {
    function GalleryComponent(imageService, http, changeDetectorRef) {
        this.imageService = imageService;
        this.http = http;
        this.changeDetectorRef = changeDetectorRef;
        this.gallery = [];
        this.imageDataStaticPath = 'assets/img/gallery/';
        this.imageDataCompletePath = '';
        this.dataFileName = 'data.json';
        this.images = [];
        this.minimalQualityCategory = 'preview_xxs';
        this.rowIndex = 0;
        this.rightArrowInactive = false;
        this.leftArrowInactive = false;
        this.providedImageMargin = 3;
        this.providedImageSize = 7;
        this.providedGalleryName = '';
        this.providedMetadataUri = undefined;
        this.rowsPerPage = 200;
        this.viewerChange = new EventEmitter();
    }
    /**
     * @param {?} event
     * @return {?}
     */
    GalleryComponent.prototype.triggerCycle = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.scaleGallery();
    };
    /**
     * @param {?} event
     * @return {?}
     */
    GalleryComponent.prototype.windowResize = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.render();
    };
    /**
     * @return {?}
     */
    GalleryComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.fetchDataAndRender();
        this.viewerSubscription = this.imageService.showImageViewerChanged$
            .subscribe(function (visibility) { return _this.viewerChange.emit(visibility); });
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    GalleryComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        // input params changed
        if (changes['providedGalleryName'] != undefined) {
            this.fetchDataAndRender();
        }
        else {
            this.render();
        }
    };
    /**
     * @return {?}
     */
    GalleryComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this.viewerSubscription) {
            this.viewerSubscription.unsubscribe();
        }
    };
    /**
     * @param {?} img
     * @return {?}
     */
    GalleryComponent.prototype.openImageViewer = /**
     * @param {?} img
     * @return {?}
     */
    function (img) {
        this.imageService.updateImages(this.images);
        this.imageService.updateSelectedImageIndex(this.images.indexOf(img));
        this.imageService.showImageViewer(true);
    };
    /**
     * direction (-1: left, 1: right)
     */
    /**
     * direction (-1: left, 1: right)
     * @param {?} direction
     * @return {?}
     */
    GalleryComponent.prototype.navigate = /**
     * direction (-1: left, 1: right)
     * @param {?} direction
     * @return {?}
     */
    function (direction) {
        if ((direction === 1 && this.rowIndex < this.gallery.length - this.rowsPerPage)
            || (direction === -1 && this.rowIndex > 0)) {
            this.rowIndex += (this.rowsPerPage * direction);
        }
        this.refreshNavigationErrorState();
    };
    /**
     * @return {?}
     */
    GalleryComponent.prototype.calcImageMargin = /**
     * @return {?}
     */
    function () {
        var /** @type {?} */ galleryWidth = this.getGalleryWidth();
        var /** @type {?} */ ratio = galleryWidth / 1920;
        return Math.round(Math.max(1, this.providedImageMargin * ratio));
    };
    /**
     * @return {?}
     */
    GalleryComponent.prototype.fetchDataAndRender = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.imageDataCompletePath = this.providedMetadataUri;
        if (!this.providedMetadataUri) {
            this.imageDataCompletePath = this.providedGalleryName !== '' ?
                this.imageDataStaticPath + this.providedGalleryName + "/" + this.dataFileName :
                this.imageDataStaticPath + this.dataFileName;
        }
        this.http.get(this.imageDataCompletePath)
            .subscribe(function (data) {
            _this.images = data;
            _this.imageService.updateImages(_this.images);
            _this.images.forEach(function (image) {
                image['galleryImageLoaded'] = false;
                image['viewerImageLoaded'] = false;
                image['srcAfterFocus'] = '';
            });
            // twice, single leads to different strange browser behaviour
            // twice, single leads to different strange browser behaviour
            _this.render();
            _this.render();
        }, function (err) {
            if (_this.providedMetadataUri) {
                console.error("Provided endpoint '" + _this.providedMetadataUri + "' did not serve metadata correctly or in the expected format.\n      See here for more information: https://github.com/BenjaminBrandmeier/angular2-image-gallery/blob/master/docs/externalDataSource.md,\n      Original error: " + err);
            }
            else {
                console.error("Did you run the convert script from angular2-image-gallery for your images first? Original error: " + err);
            }
        }, function () { return undefined; });
    };
    /**
     * @return {?}
     */
    GalleryComponent.prototype.render = /**
     * @return {?}
     */
    function () {
        this.gallery = [];
        var /** @type {?} */ tempRow = [this.images[0]];
        var /** @type {?} */ currentRowIndex = 0;
        var /** @type {?} */ i = 0;
        for (i; i < this.images.length; i++) {
            while (this.images[i + 1] && this.shouldAddCandidate(tempRow, this.images[i + 1])) {
                i++;
            }
            if (this.images[i + 1]) {
                tempRow.pop();
            }
            this.gallery[currentRowIndex++] = tempRow;
            tempRow = [this.images[i + 1]];
        }
        this.scaleGallery();
    };
    /**
     * @param {?} imgRow
     * @param {?} candidate
     * @return {?}
     */
    GalleryComponent.prototype.shouldAddCandidate = /**
     * @param {?} imgRow
     * @param {?} candidate
     * @return {?}
     */
    function (imgRow, candidate) {
        var /** @type {?} */ oldDifference = this.calcIdealHeight() - this.calcRowHeight(imgRow);
        imgRow.push(candidate);
        var /** @type {?} */ newDifference = this.calcIdealHeight() - this.calcRowHeight(imgRow);
        return Math.abs(oldDifference) > Math.abs(newDifference);
    };
    /**
     * @param {?} imgRow
     * @return {?}
     */
    GalleryComponent.prototype.calcRowHeight = /**
     * @param {?} imgRow
     * @return {?}
     */
    function (imgRow) {
        var /** @type {?} */ originalRowWidth = this.calcOriginalRowWidth(imgRow);
        var /** @type {?} */ ratio = (this.getGalleryWidth() - (imgRow.length - 1) * this.calcImageMargin()) / originalRowWidth;
        var /** @type {?} */ rowHeight = imgRow[0][this.minimalQualityCategory]['height'] * ratio;
        return rowHeight;
    };
    /**
     * @param {?} imgRow
     * @return {?}
     */
    GalleryComponent.prototype.calcOriginalRowWidth = /**
     * @param {?} imgRow
     * @return {?}
     */
    function (imgRow) {
        var _this = this;
        var /** @type {?} */ originalRowWidth = 0;
        imgRow.forEach(function (img) {
            var /** @type {?} */ individualRatio = _this.calcIdealHeight() / img[_this.minimalQualityCategory]['height'];
            img[_this.minimalQualityCategory]['width'] = img[_this.minimalQualityCategory]['width'] * individualRatio;
            img[_this.minimalQualityCategory]['height'] = _this.calcIdealHeight();
            originalRowWidth += img[_this.minimalQualityCategory]['width'];
        });
        return originalRowWidth;
    };
    /**
     * @return {?}
     */
    GalleryComponent.prototype.calcIdealHeight = /**
     * @return {?}
     */
    function () {
        return this.getGalleryWidth() / (80 / this.providedImageSize) + 100;
    };
    /**
     * @return {?}
     */
    GalleryComponent.prototype.getGalleryWidth = /**
     * @return {?}
     */
    function () {
        if (this.galleryContainer.nativeElement.clientWidth === 0) {
            // for IE11
            return this.galleryContainer.nativeElement.scrollWidth;
        }
        return this.galleryContainer.nativeElement.clientWidth;
    };
    /**
     * @return {?}
     */
    GalleryComponent.prototype.scaleGallery = /**
     * @return {?}
     */
    function () {
        var _this = this;
        var /** @type {?} */ imageCounter = 0;
        var /** @type {?} */ maximumGalleryImageHeight = 0;
        this.gallery.slice(this.rowIndex, this.rowIndex + this.rowsPerPage)
            .forEach(function (imgRow) {
            var /** @type {?} */ originalRowWidth = _this.calcOriginalRowWidth(imgRow);
            if (imgRow !== _this.gallery[_this.gallery.length - 1]) {
                var /** @type {?} */ ratio_1 = (_this.getGalleryWidth() - (imgRow.length - 1) * _this.calcImageMargin()) / originalRowWidth;
                imgRow.forEach(function (img) {
                    img['width'] = img[_this.minimalQualityCategory]['width'] * ratio_1;
                    img['height'] = img[_this.minimalQualityCategory]['height'] * ratio_1;
                    maximumGalleryImageHeight = Math.max(maximumGalleryImageHeight, img['height']);
                    _this.checkForAsyncLoading(img, imageCounter++);
                });
            }
            else {
                imgRow.forEach(function (img) {
                    img.width = img[_this.minimalQualityCategory]['width'];
                    img.height = img[_this.minimalQualityCategory]['height'];
                    maximumGalleryImageHeight = Math.max(maximumGalleryImageHeight, img['height']);
                    _this.checkForAsyncLoading(img, imageCounter++);
                });
            }
        });
        this.minimalQualityCategory = maximumGalleryImageHeight > 375 ? 'preview_xs' : 'preview_xxs';
        this.refreshNavigationErrorState();
        this.changeDetectorRef.detectChanges();
    };
    /**
     * @param {?} image
     * @param {?} imageCounter
     * @return {?}
     */
    GalleryComponent.prototype.checkForAsyncLoading = /**
     * @param {?} image
     * @param {?} imageCounter
     * @return {?}
     */
    function (image, imageCounter) {
        var /** @type {?} */ imageElements = this.imageElements.toArray();
        if (image['galleryImageLoaded'] ||
            (imageElements.length > 0 &&
                imageElements[imageCounter] &&
                this.isScrolledIntoView(imageElements[imageCounter].nativeElement))) {
            image['galleryImageLoaded'] = true;
            image['srcAfterFocus'] = image[this.minimalQualityCategory]['path'];
        }
        else {
            image['srcAfterFocus'] = '';
        }
    };
    /**
     * @param {?} element
     * @return {?}
     */
    GalleryComponent.prototype.isScrolledIntoView = /**
     * @param {?} element
     * @return {?}
     */
    function (element) {
        var /** @type {?} */ elementTop = element.getBoundingClientRect().top;
        var /** @type {?} */ elementBottom = element.getBoundingClientRect().bottom;
        return elementTop < window.innerHeight && elementBottom >= 0 && (elementBottom > 0 || elementTop > 0);
    };
    /**
     * @return {?}
     */
    GalleryComponent.prototype.refreshNavigationErrorState = /**
     * @return {?}
     */
    function () {
        this.leftArrowInactive = this.rowIndex == 0;
        this.rightArrowInactive = this.rowIndex > (this.gallery.length - this.rowsPerPage);
    };
    GalleryComponent.decorators = [
        { type: Component, args: [{
                    selector: 'gallery',
                    template: "<div #galleryContainer class=\"galleryContainer\">\n    <div class=\"innerGalleryContainer\">\n        <div *ngFor='let imgrow of gallery | slice:rowIndex:rowIndex+rowsPerPage; let i = index'\n             class=\"imagerow\"\n             [style.margin-bottom.px]=\"calcImageMargin()\">\n            <img #imageElement\n                 *ngFor='let img of imgrow; let j = index'\n                 class=\"thumbnail\"\n                 [style.width.px]=\"img['width']\"\n                 [style.height.px]=\"img['height']\"\n                 (click)=\"openImageViewer(img)\"\n                 [src]=\"img['srcAfterFocus']\"\n                 [style.background]=\"img.dominantColor\"\n                 [style.margin-right.px]=\"calcImageMargin()\"/>\n        </div>\n    </div>\n\n    <div class=\"pagerContainer\" *ngIf=\"(!rightArrowInactive || !leftArrowInactive)\">\n        <img [ngClass]=\"{'inactive': leftArrowInactive}\" class=\"pager left\"\n             src=\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgaWQ9IkxheWVyXzEiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDQ4IDQ4OyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgNDggNDgiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxnPjxwYXRoIGQ9Ik0yNCw0NkMxMS45LDQ2LDIsMzYuMSwyLDI0UzExLjksMiwyNCwyczIyLDkuOSwyMiwyMlMzNi4xLDQ2LDI0LDQ2eiBNMjQsNEMxMyw0LDQsMTMsNCwyNGMwLDExLDksMjAsMjAsMjAgICBjMTEsMCwyMC05LDIwLTIwQzQ0LDEzLDM1LDQsMjQsNHoiLz48L2c+PGc+PHBvbHlnb24gcG9pbnRzPSIyNy42LDM2LjcgMTQuOSwyNCAyNy42LDExLjMgMjkuMSwxMi43IDE3LjgsMjQgMjkuMSwzNS4zICAiLz48L2c+PC9zdmc+\"\n             (click)=\"navigate(-1)\"/>\n        <img [ngClass]=\"{'inactive': rightArrowInactive}\" class=\"pager right\"\n             src=\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgaWQ9IkxheWVyXzEiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDQ4IDQ4OyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgNDggNDgiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxnPjxwYXRoIGQ9Ik0yNCw0NkMxMS45LDQ2LDIsMzYuMSwyLDI0UzExLjksMiwyNCwyczIyLDkuOSwyMiwyMlMzNi4xLDQ2LDI0LDQ2eiBNMjQsNEMxMyw0LDQsMTMsNCwyNHM5LDIwLDIwLDIwczIwLTksMjAtMjAgICBTMzUsNCwyNCw0eiIvPjwvZz48Zz48cG9seWdvbiBwb2ludHM9IjIxLjQsMzYuNyAxOS45LDM1LjMgMzEuMiwyNCAxOS45LDEyLjcgMjEuNCwxMS4zIDM0LjEsMjQgICIvPjwvZz48L3N2Zz4=\"\n             (click)=\"navigate(1)\"/>\n    </div>\n</div>\n\n<viewer></viewer>\n",
                    styles: [".innerGalleryContainer{position:relative}.galleryContainer{height:100%;width:100%;overflow:hidden}.innerGalleryContainer img:last-child{margin-right:-1px!important}.galleryContainer img:hover{-webkit-filter:brightness(50%);filter:brightness(50%);transition:all ease-out .2s;cursor:pointer}.imagerow{margin-right:1px;overflow:hidden;display:flex}::-webkit-scrollbar{display:none}.asyncLoadingContainer{position:absolute;background-color:transparent;height:0;width:0;bottom:120px}.pagerContainer{margin:40px auto;width:180px}.pager{display:block;height:60px}@media (max-width:700px){.pagerContainer{margin:40px auto;width:150px}.pager{display:block;height:45px}}.pager.inactive{opacity:.15}.pager.left{float:left}.pager.right{float:right}"]
                },] },
    ];
    /** @nocollapse */
    GalleryComponent.ctorParameters = function () { return [
        { type: ImageService },
        { type: HttpClient },
        { type: ChangeDetectorRef }
    ]; };
    GalleryComponent.propDecorators = {
        providedImageMargin: [{ type: Input, args: ['flexBorderSize',] }],
        providedImageSize: [{ type: Input, args: ['flexImageSize',] }],
        providedGalleryName: [{ type: Input, args: ['galleryName',] }],
        providedMetadataUri: [{ type: Input, args: ['metadataUri',] }],
        rowsPerPage: [{ type: Input, args: ['maxRowsPerPage',] }],
        viewerChange: [{ type: Output }],
        galleryContainer: [{ type: ViewChild, args: ['galleryContainer',] }],
        imageElements: [{ type: ViewChildren, args: ['imageElement',] }],
        triggerCycle: [{ type: HostListener, args: ['window:scroll', ['$event'],] }],
        windowResize: [{ type: HostListener, args: ['window:resize', ['$event'],] }]
    };
    return GalleryComponent;
}());
export { GalleryComponent };
function GalleryComponent_tsickle_Closure_declarations() {
    /** @type {?} */
    GalleryComponent.prototype.gallery;
    /** @type {?} */
    GalleryComponent.prototype.imageDataStaticPath;
    /** @type {?} */
    GalleryComponent.prototype.imageDataCompletePath;
    /** @type {?} */
    GalleryComponent.prototype.dataFileName;
    /** @type {?} */
    GalleryComponent.prototype.images;
    /** @type {?} */
    GalleryComponent.prototype.minimalQualityCategory;
    /** @type {?} */
    GalleryComponent.prototype.viewerSubscription;
    /** @type {?} */
    GalleryComponent.prototype.rowIndex;
    /** @type {?} */
    GalleryComponent.prototype.rightArrowInactive;
    /** @type {?} */
    GalleryComponent.prototype.leftArrowInactive;
    /** @type {?} */
    GalleryComponent.prototype.providedImageMargin;
    /** @type {?} */
    GalleryComponent.prototype.providedImageSize;
    /** @type {?} */
    GalleryComponent.prototype.providedGalleryName;
    /** @type {?} */
    GalleryComponent.prototype.providedMetadataUri;
    /** @type {?} */
    GalleryComponent.prototype.rowsPerPage;
    /** @type {?} */
    GalleryComponent.prototype.viewerChange;
    /** @type {?} */
    GalleryComponent.prototype.galleryContainer;
    /** @type {?} */
    GalleryComponent.prototype.imageElements;
    /** @type {?} */
    GalleryComponent.prototype.imageService;
    /** @type {?} */
    GalleryComponent.prototype.http;
    /** @type {?} */
    GalleryComponent.prototype.changeDetectorRef;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2FsbGVyeS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmd1bGFyMi1pbWFnZS1nYWxsZXJ5LyIsInNvdXJjZXMiOlsibGliL2dhbGxlcnkvZ2FsbGVyeS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFDTCxpQkFBaUIsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxZQUFZLEVBQ3BFLEtBQUssRUFBZ0MsTUFBTSxFQUFFLFNBQVMsRUFBaUIsU0FBUyxFQUFFLFlBQVksRUFDL0YsTUFBTSxlQUFlLENBQUE7QUFDdEIsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDJCQUEyQixDQUFBO0FBRXhELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQTs7SUFrRTdDLDBCQUFtQixZQUEwQixFQUFTLElBQWdCLEVBQVMsaUJBQW9DO1FBQWhHLGlCQUFZLEdBQVosWUFBWSxDQUFjO1FBQVMsU0FBSSxHQUFKLElBQUksQ0FBWTtRQUFTLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7dUJBOUI3RixFQUFFO21DQUNNLHFCQUFxQjtxQ0FDbkIsRUFBRTs0QkFDWCxXQUFXO3NCQUNiLEVBQUU7c0NBQ0UsYUFBYTt3QkFFbkIsQ0FBQztrQ0FDVSxLQUFLO2lDQUNOLEtBQUs7bUNBRXFCLENBQUM7aUNBQ0osQ0FBQzttQ0FDRCxFQUFFO21DQUNGLFNBQVM7MkJBQ2QsR0FBRzs0QkFFekIsSUFBSSxZQUFZLEVBQVc7S0FjbkQ7Ozs7O0lBVDBDLHVDQUFZOzs7O0lBQXZELFVBQXdELEtBQVU7UUFDOUQsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFBO0tBQ3RCOzs7OztJQUUwQyx1Q0FBWTs7OztJQUF2RCxVQUF3RCxLQUFVO1FBQzlELElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQTtLQUNoQjs7OztJQUtELG1DQUFROzs7SUFBUjtRQUFBLGlCQUlDO1FBSEcsSUFBSSxDQUFDLGtCQUFrQixF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ZUFBZTtzQ0FDckIsS0FBSyxTQUFDLGFBQWE7c0NBQ25CLEtBQUssU0FBQyxhQUFhOzhCQUNuQixLQUFLLFNBQUMsZ0JBQWdCOytCQUV0QixNQUFNO21DQUVOLFNBQVMsU0FBQyxrQkFBa0I7Z0NBQzVCLFlBQVksU0FBQyxjQUFjOytCQUUzQixZQUFZLFNBQUMsZUFBZSxFQUFFLENBQUMsUUFBUSxDQUFDOytCQUl4QyxZQUFZLFNBQUMsZUFBZSxFQUFFLENBQUMsUUFBUSxDQUFDOzsyQkFwRTdDOztTQXlDYSxnQkFBZ0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDaGFuZ2VEZXRlY3RvclJlZiwgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBFdmVudEVtaXR0ZXIsIEhvc3RMaXN0ZW5lcixcbiAgSW5wdXQsIE9uQ2hhbmdlcywgT25EZXN0cm95LCBPbkluaXQsIE91dHB1dCwgUXVlcnlMaXN0LCBTaW1wbGVDaGFuZ2VzLCBWaWV3Q2hpbGQsIFZpZXdDaGlsZHJlblxufSBmcm9tICdAYW5ndWxhci9jb3JlJ1xuaW1wb3J0IHsgSW1hZ2VTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvaW1hZ2Uuc2VydmljZSdcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMvaW50ZXJuYWwvU3Vic2NyaXB0aW9uJ1xuaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJ1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2dhbGxlcnknLFxuICAgIHRlbXBsYXRlOiBgPGRpdiAjZ2FsbGVyeUNvbnRhaW5lciBjbGFzcz1cImdhbGxlcnlDb250YWluZXJcIj5cbiAgICA8ZGl2IGNsYXNzPVwiaW5uZXJHYWxsZXJ5Q29udGFpbmVyXCI+XG4gICAgICAgIDxkaXYgKm5nRm9yPSdsZXQgaW1ncm93IG9mIGdhbGxlcnkgfCBzbGljZTpyb3dJbmRleDpyb3dJbmRleCtyb3dzUGVyUGFnZTsgbGV0IGkgPSBpbmRleCdcbiAgICAgICAgICAgICBjbGFzcz1cImltYWdlcm93XCJcbiAgICAgICAgICAgICBbc3R5bGUubWFyZ2luLWJvdHRvbS5weF09XCJjYWxjSW1hZ2VNYXJnaW4oKVwiPlxuICAgICAgICAgICAgPGltZyAjaW1hZ2VFbGVtZW50XG4gICAgICAgICAgICAgICAgICpuZ0Zvcj0nbGV0IGltZyBvZiBpbWdyb3c7IGxldCBqID0gaW5kZXgnXG4gICAgICAgICAgICAgICAgIGNsYXNzPVwidGh1bWJuYWlsXCJcbiAgICAgICAgICAgICAgICAgW3N0eWxlLndpZHRoLnB4XT1cImltZ1snd2lkdGgnXVwiXG4gICAgICAgICAgICAgICAgIFtzdHlsZS5oZWlnaHQucHhdPVwiaW1nWydoZWlnaHQnXVwiXG4gICAgICAgICAgICAgICAgIChjbGljayk9XCJvcGVuSW1hZ2VWaWV3ZXIoaW1nKVwiXG4gICAgICAgICAgICAgICAgIFtzcmNdPVwiaW1nWydzcmNBZnRlckZvY3VzJ11cIlxuICAgICAgICAgICAgICAgICBbc3R5bGUuYmFja2dyb3VuZF09XCJpbWcuZG9taW5hbnRDb2xvclwiXG4gICAgICAgICAgICAgICAgIFtzdHlsZS5tYXJnaW4tcmlnaHQucHhdPVwiY2FsY0ltYWdlTWFyZ2luKClcIi8+XG4gICAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuXG4gICAgPGRpdiBjbGFzcz1cInBhZ2VyQ29udGFpbmVyXCIgKm5nSWY9XCIoIXJpZ2h0QXJyb3dJbmFjdGl2ZSB8fCAhbGVmdEFycm93SW5hY3RpdmUpXCI+XG4gICAgICAgIDxpbWcgW25nQ2xhc3NdPVwieydpbmFjdGl2ZSc6IGxlZnRBcnJvd0luYWN0aXZlfVwiIGNsYXNzPVwicGFnZXIgbGVmdFwiXG4gICAgICAgICAgICAgc3JjPVwiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQRDk0Yld3Z2RtVnljMmx2YmowaU1TNHdJaUEvUGp4emRtY2dhV1E5SWt4aGVXVnlYekVpSUhOMGVXeGxQU0psYm1GaWJHVXRZbUZqYTJkeWIzVnVaRHB1WlhjZ01DQXdJRFE0SURRNE95SWdkbVZ5YzJsdmJqMGlNUzR4SWlCMmFXVjNRbTk0UFNJd0lEQWdORGdnTkRnaUlIaHRiRHB6Y0dGalpUMGljSEpsYzJWeWRtVWlJSGh0Ykc1elBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHlNREF3TDNOMlp5SWdlRzFzYm5NNmVHeHBibXM5SW1oMGRIQTZMeTkzZDNjdWR6TXViM0puTHpFNU9Ua3ZlR3hwYm1zaVBqeG5Qanh3WVhSb0lHUTlJazB5TkN3ME5rTXhNUzQ1TERRMkxESXNNell1TVN3eUxESTBVekV4TGprc01pd3lOQ3d5Y3pJeUxEa3VPU3d5TWl3eU1sTXpOaTR4TERRMkxESTBMRFEyZWlCTk1qUXNORU14TXl3MExEUXNNVE1zTkN3eU5HTXdMREV4TERrc01qQXNNakFzTWpBZ0lDQmpNVEVzTUN3eU1DMDVMREl3TFRJd1F6UTBMREV6TERNMUxEUXNNalFzTkhvaUx6NDhMMmMrUEdjK1BIQnZiSGxuYjI0Z2NHOXBiblJ6UFNJeU55NDJMRE0yTGpjZ01UUXVPU3d5TkNBeU55NDJMREV4TGpNZ01qa3VNU3d4TWk0M0lERTNMamdzTWpRZ01qa3VNU3d6TlM0eklDQWlMejQ4TDJjK1BDOXpkbWMrXCJcbiAgICAgICAgICAgICAoY2xpY2spPVwibmF2aWdhdGUoLTEpXCIvPlxuICAgICAgICA8aW1nIFtuZ0NsYXNzXT1cInsnaW5hY3RpdmUnOiByaWdodEFycm93SW5hY3RpdmV9XCIgY2xhc3M9XCJwYWdlciByaWdodFwiXG4gICAgICAgICAgICAgc3JjPVwiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQRDk0Yld3Z2RtVnljMmx2YmowaU1TNHdJaUEvUGp4emRtY2dhV1E5SWt4aGVXVnlYekVpSUhOMGVXeGxQU0psYm1GaWJHVXRZbUZqYTJkeWIzVnVaRHB1WlhjZ01DQXdJRFE0SURRNE95SWdkbVZ5YzJsdmJqMGlNUzR4SWlCMmFXVjNRbTk0UFNJd0lEQWdORGdnTkRnaUlIaHRiRHB6Y0dGalpUMGljSEpsYzJWeWRtVWlJSGh0Ykc1elBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHlNREF3TDNOMlp5SWdlRzFzYm5NNmVHeHBibXM5SW1oMGRIQTZMeTkzZDNjdWR6TXViM0puTHpFNU9Ua3ZlR3hwYm1zaVBqeG5Qanh3WVhSb0lHUTlJazB5TkN3ME5rTXhNUzQ1TERRMkxESXNNell1TVN3eUxESTBVekV4TGprc01pd3lOQ3d5Y3pJeUxEa3VPU3d5TWl3eU1sTXpOaTR4TERRMkxESTBMRFEyZWlCTk1qUXNORU14TXl3MExEUXNNVE1zTkN3eU5ITTVMREl3TERJd0xESXdjekl3TFRrc01qQXRNakFnSUNCVE16VXNOQ3d5TkN3MGVpSXZQand2Wno0OFp6NDhjRzlzZVdkdmJpQndiMmx1ZEhNOUlqSXhMalFzTXpZdU55QXhPUzQ1TERNMUxqTWdNekV1TWl3eU5DQXhPUzQ1TERFeUxqY2dNakV1TkN3eE1TNHpJRE0wTGpFc01qUWdJQ0l2UGp3dlp6NDhMM04yWno0PVwiXG4gICAgICAgICAgICAgKGNsaWNrKT1cIm5hdmlnYXRlKDEpXCIvPlxuICAgIDwvZGl2PlxuPC9kaXY+XG5cbjx2aWV3ZXI+PC92aWV3ZXI+XG5gLFxuICAgIHN0eWxlczogW2AuaW5uZXJHYWxsZXJ5Q29udGFpbmVye3Bvc2l0aW9uOnJlbGF0aXZlfS5nYWxsZXJ5Q29udGFpbmVye2hlaWdodDoxMDAlO3dpZHRoOjEwMCU7b3ZlcmZsb3c6aGlkZGVufS5pbm5lckdhbGxlcnlDb250YWluZXIgaW1nOmxhc3QtY2hpbGR7bWFyZ2luLXJpZ2h0Oi0xcHghaW1wb3J0YW50fS5nYWxsZXJ5Q29udGFpbmVyIGltZzpob3Zlcnstd2Via2l0LWZpbHRlcjpicmlnaHRuZXNzKDUwJSk7ZmlsdGVyOmJyaWdodG5lc3MoNTAlKTt0cmFuc2l0aW9uOmFsbCBlYXNlLW91dCAuMnM7Y3Vyc29yOnBvaW50ZXJ9LmltYWdlcm93e21hcmdpbi1yaWdodDoxcHg7b3ZlcmZsb3c6aGlkZGVuO2Rpc3BsYXk6ZmxleH06Oi13ZWJraXQtc2Nyb2xsYmFye2Rpc3BsYXk6bm9uZX0uYXN5bmNMb2FkaW5nQ29udGFpbmVye3Bvc2l0aW9uOmFic29sdXRlO2JhY2tncm91bmQtY29sb3I6dHJhbnNwYXJlbnQ7aGVpZ2h0OjA7d2lkdGg6MDtib3R0b206MTIwcHh9LnBhZ2VyQ29udGFpbmVye21hcmdpbjo0MHB4IGF1dG87d2lkdGg6MTgwcHh9LnBhZ2Vye2Rpc3BsYXk6YmxvY2s7aGVpZ2h0OjYwcHh9QG1lZGlhIChtYXgtd2lkdGg6NzAwcHgpey5wYWdlckNvbnRhaW5lcnttYXJnaW46NDBweCBhdXRvO3dpZHRoOjE1MHB4fS5wYWdlcntkaXNwbGF5OmJsb2NrO2hlaWdodDo0NXB4fX0ucGFnZXIuaW5hY3RpdmV7b3BhY2l0eTouMTV9LnBhZ2VyLmxlZnR7ZmxvYXQ6bGVmdH0ucGFnZXIucmlnaHR7ZmxvYXQ6cmlnaHR9YF1cbn0pXG5leHBvcnQgY2xhc3MgR2FsbGVyeUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95LCBPbkNoYW5nZXMge1xuICAgIGdhbGxlcnk6IEFycmF5PGFueT4gPSBbXVxuICAgIGltYWdlRGF0YVN0YXRpY1BhdGg6IHN0cmluZyA9ICdhc3NldHMvaW1nL2dhbGxlcnkvJ1xuICAgIGltYWdlRGF0YUNvbXBsZXRlUGF0aDogc3RyaW5nID0gJydcbiAgICBkYXRhRmlsZU5hbWU6IHN0cmluZyA9ICdkYXRhLmpzb24nXG4gICAgaW1hZ2VzOiBBcnJheTxhbnk+ID0gW11cbiAgICBtaW5pbWFsUXVhbGl0eUNhdGVnb3J5ID0gJ3ByZXZpZXdfeHhzJ1xuICAgIHZpZXdlclN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uXG4gICAgcm93SW5kZXg6IG51bWJlciA9IDBcbiAgICByaWdodEFycm93SW5hY3RpdmU6IGJvb2xlYW4gPSBmYWxzZVxuICAgIGxlZnRBcnJvd0luYWN0aXZlOiBib29sZWFuID0gZmFsc2VcblxuICAgIEBJbnB1dCgnZmxleEJvcmRlclNpemUnKSBwcm92aWRlZEltYWdlTWFyZ2luOiBudW1iZXIgPSAzXG4gICAgQElucHV0KCdmbGV4SW1hZ2VTaXplJykgcHJvdmlkZWRJbWFnZVNpemU6IG51bWJlciA9IDdcbiAgICBASW5wdXQoJ2dhbGxlcnlOYW1lJykgcHJvdmlkZWRHYWxsZXJ5TmFtZTogc3RyaW5nID0gJydcbiAgICBASW5wdXQoJ21ldGFkYXRhVXJpJykgcHJvdmlkZWRNZXRhZGF0YVVyaTogc3RyaW5nID0gdW5kZWZpbmVkXG4gICAgQElucHV0KCdtYXhSb3dzUGVyUGFnZScpIHJvd3NQZXJQYWdlOiBudW1iZXIgPSAyMDBcblxuICAgIEBPdXRwdXQoKSB2aWV3ZXJDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KClcblxuICAgIEBWaWV3Q2hpbGQoJ2dhbGxlcnlDb250YWluZXInKSBnYWxsZXJ5Q29udGFpbmVyOiBFbGVtZW50UmVmXG4gICAgQFZpZXdDaGlsZHJlbignaW1hZ2VFbGVtZW50JykgaW1hZ2VFbGVtZW50czogUXVlcnlMaXN0PGFueT5cblxuICAgIEBIb3N0TGlzdGVuZXIoJ3dpbmRvdzpzY3JvbGwnLCBbJyRldmVudCddKSB0cmlnZ2VyQ3ljbGUoZXZlbnQ6IGFueSk6IHZvaWQge1xuICAgICAgICB0aGlzLnNjYWxlR2FsbGVyeSgpXG4gICAgfVxuXG4gICAgQEhvc3RMaXN0ZW5lcignd2luZG93OnJlc2l6ZScsIFsnJGV2ZW50J10pIHdpbmRvd1Jlc2l6ZShldmVudDogYW55KTogdm9pZCB7XG4gICAgICAgIHRoaXMucmVuZGVyKClcbiAgICB9XG5cbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgaW1hZ2VTZXJ2aWNlOiBJbWFnZVNlcnZpY2UsIHB1YmxpYyBodHRwOiBIdHRwQ2xpZW50LCBwdWJsaWMgY2hhbmdlRGV0ZWN0b3JSZWY6IENoYW5nZURldGVjdG9yUmVmKSB7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuZmV0Y2hEYXRhQW5kUmVuZGVyKClcbiAgICAgICAgdGhpcy52aWV3ZXJTdWJzY3JpcHRpb24gPSB0aGlzLmltYWdlU2VydmljZS5zaG93SW1hZ2VWaWV3ZXJDaGFuZ2VkJFxuICAgICAgICAgICAgLnN1YnNjcmliZSgodmlzaWJpbGl0eTogYm9vbGVhbikgPT4gdGhpcy52aWV3ZXJDaGFuZ2UuZW1pdCh2aXNpYmlsaXR5KSlcbiAgICB9XG5cbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XG4gICAgICAgIC8vIGlucHV0IHBhcmFtcyBjaGFuZ2VkXG4gICAgICAgIGlmIChjaGFuZ2VzWydwcm92aWRlZEdhbGxlcnlOYW1lJ10gIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmZldGNoRGF0YUFuZFJlbmRlcigpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnJlbmRlcigpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMudmlld2VyU3Vic2NyaXB0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLnZpZXdlclN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvcGVuSW1hZ2VWaWV3ZXIoaW1nOiBhbnkpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5pbWFnZVNlcnZpY2UudXBkYXRlSW1hZ2VzKHRoaXMuaW1hZ2VzKVxuICAgICAgICB0aGlzLmltYWdlU2VydmljZS51cGRhdGVTZWxlY3RlZEltYWdlSW5kZXgodGhpcy5pbWFnZXMuaW5kZXhPZihpbWcpKVxuICAgICAgICB0aGlzLmltYWdlU2VydmljZS5zaG93SW1hZ2VWaWV3ZXIodHJ1ZSlcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBkaXJlY3Rpb24gKC0xOiBsZWZ0LCAxOiByaWdodClcbiAgICAgKi9cbiAgICBuYXZpZ2F0ZShkaXJlY3Rpb246IG51bWJlcik6IHZvaWQge1xuICAgICAgICBpZiAoKGRpcmVjdGlvbiA9PT0gMSAmJiB0aGlzLnJvd0luZGV4IDwgdGhpcy5nYWxsZXJ5Lmxlbmd0aCAtIHRoaXMucm93c1BlclBhZ2UpXG4gICAgICAgICAgICB8fCAoZGlyZWN0aW9uID09PSAtMSAmJiB0aGlzLnJvd0luZGV4ID4gMCkpIHtcbiAgICAgICAgICAgIHRoaXMucm93SW5kZXggKz0gKHRoaXMucm93c1BlclBhZ2UgKiBkaXJlY3Rpb24pXG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yZWZyZXNoTmF2aWdhdGlvbkVycm9yU3RhdGUoKVxuICAgIH1cblxuICAgIGNhbGNJbWFnZU1hcmdpbigpOiBudW1iZXIge1xuICAgICAgICBjb25zdCBnYWxsZXJ5V2lkdGggPSB0aGlzLmdldEdhbGxlcnlXaWR0aCgpXG4gICAgICAgIGNvbnN0IHJhdGlvID0gZ2FsbGVyeVdpZHRoIC8gMTkyMFxuICAgICAgICByZXR1cm4gTWF0aC5yb3VuZChNYXRoLm1heCgxLCB0aGlzLnByb3ZpZGVkSW1hZ2VNYXJnaW4gKiByYXRpbykpXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBmZXRjaERhdGFBbmRSZW5kZXIoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuaW1hZ2VEYXRhQ29tcGxldGVQYXRoID0gdGhpcy5wcm92aWRlZE1ldGFkYXRhVXJpXG5cbiAgICAgICAgaWYgKCF0aGlzLnByb3ZpZGVkTWV0YWRhdGFVcmkpIHtcbiAgICAgICAgICAgIHRoaXMuaW1hZ2VEYXRhQ29tcGxldGVQYXRoID0gdGhpcy5wcm92aWRlZEdhbGxlcnlOYW1lICE9PSAnJyA/XG4gICAgICAgICAgICAgICAgYCR7dGhpcy5pbWFnZURhdGFTdGF0aWNQYXRoICsgdGhpcy5wcm92aWRlZEdhbGxlcnlOYW1lfS8ke3RoaXMuZGF0YUZpbGVOYW1lfWAgOlxuICAgICAgICAgICAgICAgIHRoaXMuaW1hZ2VEYXRhU3RhdGljUGF0aCArIHRoaXMuZGF0YUZpbGVOYW1lXG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmh0dHAuZ2V0KHRoaXMuaW1hZ2VEYXRhQ29tcGxldGVQYXRoKVxuICAgICAgICAgIC5zdWJzY3JpYmUoXG4gICAgICAgICAgICAoZGF0YTogQXJyYXk8YW55PikgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmltYWdlcyA9IGRhdGFcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbWFnZVNlcnZpY2UudXBkYXRlSW1hZ2VzKHRoaXMuaW1hZ2VzKVxuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW1hZ2VzLmZvckVhY2goaW1hZ2UgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgIGltYWdlWydnYWxsZXJ5SW1hZ2VMb2FkZWQnXSA9IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgaW1hZ2VbJ3ZpZXdlckltYWdlTG9hZGVkJ10gPSBmYWxzZVxuICAgICAgICAgICAgICAgICAgICAgIGltYWdlWydzcmNBZnRlckZvY3VzJ10gPSAnJ1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAvLyB0d2ljZSwgc2luZ2xlIGxlYWRzIHRvIGRpZmZlcmVudCBzdHJhbmdlIGJyb3dzZXIgYmVoYXZpb3VyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyKClcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIoKVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGVyciA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnByb3ZpZGVkTWV0YWRhdGFVcmkpIHtcbiAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBQcm92aWRlZCBlbmRwb2ludCAnJHt0aGlzLnByb3ZpZGVkTWV0YWRhdGFVcml9JyBkaWQgbm90IHNlcnZlIG1ldGFkYXRhIGNvcnJlY3RseSBvciBpbiB0aGUgZXhwZWN0ZWQgZm9ybWF0LlxuICAgICAgU2VlIGhlcmUgZm9yIG1vcmUgaW5mb3JtYXRpb246IGh0dHBzOi8vZ2l0aHViLmNvbS9CZW5qYW1pbkJyYW5kbWVpZXIvYW5ndWxhcjItaW1hZ2UtZ2FsbGVyeS9ibG9iL21hc3Rlci9kb2NzL2V4dGVybmFsRGF0YVNvdXJjZS5tZCxcbiAgICAgIE9yaWdpbmFsIGVycm9yOiAke2Vycn1gKVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRGlkIHlvdSBydW4gdGhlIGNvbnZlcnQgc2NyaXB0IGZyb20gYW5ndWxhcjItaW1hZ2UtZ2FsbGVyeSBmb3IgeW91ciBpbWFnZXMgZmlyc3Q/IE9yaWdpbmFsIGVycm9yOiAke2Vycn1gKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAoKSA9PiB1bmRlZmluZWQpXG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZW5kZXIoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuZ2FsbGVyeSA9IFtdXG5cbiAgICAgICAgbGV0IHRlbXBSb3cgPSBbdGhpcy5pbWFnZXNbMF1dXG4gICAgICAgIGxldCBjdXJyZW50Um93SW5kZXggPSAwXG4gICAgICAgIGxldCBpID0gMFxuXG4gICAgICAgIGZvciAoaTsgaSA8IHRoaXMuaW1hZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB3aGlsZSAodGhpcy5pbWFnZXNbaSArIDFdICYmIHRoaXMuc2hvdWxkQWRkQ2FuZGlkYXRlKHRlbXBSb3csIHRoaXMuaW1hZ2VzW2kgKyAxXSkpIHtcbiAgICAgICAgICAgICAgICBpKytcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmltYWdlc1tpICsgMV0pIHtcbiAgICAgICAgICAgICAgICB0ZW1wUm93LnBvcCgpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmdhbGxlcnlbY3VycmVudFJvd0luZGV4KytdID0gdGVtcFJvd1xuXG4gICAgICAgICAgICB0ZW1wUm93ID0gW3RoaXMuaW1hZ2VzW2kgKyAxXV1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc2NhbGVHYWxsZXJ5KClcbiAgICB9XG5cbiAgICBwcml2YXRlIHNob3VsZEFkZENhbmRpZGF0ZShpbWdSb3c6IEFycmF5PGFueT4sIGNhbmRpZGF0ZTogYW55KTogYm9vbGVhbiB7XG4gICAgICAgIGNvbnN0IG9sZERpZmZlcmVuY2UgPSB0aGlzLmNhbGNJZGVhbEhlaWdodCgpIC0gdGhpcy5jYWxjUm93SGVpZ2h0KGltZ1JvdylcbiAgICAgICAgaW1nUm93LnB1c2goY2FuZGlkYXRlKVxuICAgICAgICBjb25zdCBuZXdEaWZmZXJlbmNlID0gdGhpcy5jYWxjSWRlYWxIZWlnaHQoKSAtIHRoaXMuY2FsY1Jvd0hlaWdodChpbWdSb3cpXG5cbiAgICAgICAgcmV0dXJuIE1hdGguYWJzKG9sZERpZmZlcmVuY2UpID4gTWF0aC5hYnMobmV3RGlmZmVyZW5jZSlcbiAgICB9XG5cbiAgICBwcml2YXRlIGNhbGNSb3dIZWlnaHQoaW1nUm93OiBBcnJheTxhbnk+KTogbnVtYmVyIHtcbiAgICAgICAgY29uc3Qgb3JpZ2luYWxSb3dXaWR0aCA9IHRoaXMuY2FsY09yaWdpbmFsUm93V2lkdGgoaW1nUm93KVxuXG4gICAgICAgIGNvbnN0IHJhdGlvID0gKHRoaXMuZ2V0R2FsbGVyeVdpZHRoKCkgLSAoaW1nUm93Lmxlbmd0aCAtIDEpICogdGhpcy5jYWxjSW1hZ2VNYXJnaW4oKSkgLyBvcmlnaW5hbFJvd1dpZHRoXG4gICAgICAgIGNvbnN0IHJvd0hlaWdodCA9IGltZ1Jvd1swXVt0aGlzLm1pbmltYWxRdWFsaXR5Q2F0ZWdvcnldWydoZWlnaHQnXSAqIHJhdGlvXG5cbiAgICAgICAgcmV0dXJuIHJvd0hlaWdodFxuICAgIH1cblxuICAgIHByaXZhdGUgY2FsY09yaWdpbmFsUm93V2lkdGgoaW1nUm93OiBBcnJheTxhbnk+KTogbnVtYmVyIHtcbiAgICAgICAgbGV0IG9yaWdpbmFsUm93V2lkdGggPSAwXG4gICAgICAgIGltZ1Jvdy5mb3JFYWNoKGltZyA9PiB7XG4gICAgICAgICAgICBjb25zdCBpbmRpdmlkdWFsUmF0aW8gPSB0aGlzLmNhbGNJZGVhbEhlaWdodCgpIC8gaW1nW3RoaXMubWluaW1hbFF1YWxpdHlDYXRlZ29yeV1bJ2hlaWdodCddXG4gICAgICAgICAgICBpbWdbdGhpcy5taW5pbWFsUXVhbGl0eUNhdGVnb3J5XVsnd2lkdGgnXSA9IGltZ1t0aGlzLm1pbmltYWxRdWFsaXR5Q2F0ZWdvcnldWyd3aWR0aCddICogaW5kaXZpZHVhbFJhdGlvXG4gICAgICAgICAgICBpbWdbdGhpcy5taW5pbWFsUXVhbGl0eUNhdGVnb3J5XVsnaGVpZ2h0J10gPSB0aGlzLmNhbGNJZGVhbEhlaWdodCgpXG4gICAgICAgICAgICBvcmlnaW5hbFJvd1dpZHRoICs9IGltZ1t0aGlzLm1pbmltYWxRdWFsaXR5Q2F0ZWdvcnldWyd3aWR0aCddXG4gICAgICAgIH0pXG5cbiAgICAgICAgcmV0dXJuIG9yaWdpbmFsUm93V2lkdGhcbiAgICB9XG5cbiAgICBwcml2YXRlIGNhbGNJZGVhbEhlaWdodCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRHYWxsZXJ5V2lkdGgoKSAvICg4MCAvIHRoaXMucHJvdmlkZWRJbWFnZVNpemUpICsgMTAwXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRHYWxsZXJ5V2lkdGgoKTogbnVtYmVyIHtcbiAgICAgICAgaWYgKHRoaXMuZ2FsbGVyeUNvbnRhaW5lci5uYXRpdmVFbGVtZW50LmNsaWVudFdpZHRoID09PSAwKSB7XG4gICAgICAgICAgICAvLyBmb3IgSUUxMVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2FsbGVyeUNvbnRhaW5lci5uYXRpdmVFbGVtZW50LnNjcm9sbFdpZHRoXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuZ2FsbGVyeUNvbnRhaW5lci5uYXRpdmVFbGVtZW50LmNsaWVudFdpZHRoXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzY2FsZUdhbGxlcnkoKTogdm9pZCB7XG4gICAgICAgIGxldCBpbWFnZUNvdW50ZXIgPSAwXG4gICAgICAgIGxldCBtYXhpbXVtR2FsbGVyeUltYWdlSGVpZ2h0ID0gMFxuXG4gICAgICAgIHRoaXMuZ2FsbGVyeS5zbGljZSh0aGlzLnJvd0luZGV4LCB0aGlzLnJvd0luZGV4ICsgdGhpcy5yb3dzUGVyUGFnZSlcbiAgICAgICAgICAuZm9yRWFjaChpbWdSb3cgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWxSb3dXaWR0aCA9IHRoaXMuY2FsY09yaWdpbmFsUm93V2lkdGgoaW1nUm93KVxuXG4gICAgICAgICAgICBpZiAoaW1nUm93ICE9PSB0aGlzLmdhbGxlcnlbdGhpcy5nYWxsZXJ5Lmxlbmd0aCAtIDFdKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmF0aW8gPSAodGhpcy5nZXRHYWxsZXJ5V2lkdGgoKSAtIChpbWdSb3cubGVuZ3RoIC0gMSkgKiB0aGlzLmNhbGNJbWFnZU1hcmdpbigpKSAvIG9yaWdpbmFsUm93V2lkdGhcblxuICAgICAgICAgICAgICAgIGltZ1Jvdy5mb3JFYWNoKChpbWc6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpbWdbJ3dpZHRoJ10gPSBpbWdbdGhpcy5taW5pbWFsUXVhbGl0eUNhdGVnb3J5XVsnd2lkdGgnXSAqIHJhdGlvXG4gICAgICAgICAgICAgICAgICAgIGltZ1snaGVpZ2h0J10gPSBpbWdbdGhpcy5taW5pbWFsUXVhbGl0eUNhdGVnb3J5XVsnaGVpZ2h0J10gKiByYXRpb1xuICAgICAgICAgICAgICAgICAgICBtYXhpbXVtR2FsbGVyeUltYWdlSGVpZ2h0ID0gTWF0aC5tYXgobWF4aW11bUdhbGxlcnlJbWFnZUhlaWdodCwgaW1nWydoZWlnaHQnXSlcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGVja0ZvckFzeW5jTG9hZGluZyhpbWcsIGltYWdlQ291bnRlcisrKVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGltZ1Jvdy5mb3JFYWNoKChpbWc6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpbWcud2lkdGggPSBpbWdbdGhpcy5taW5pbWFsUXVhbGl0eUNhdGVnb3J5XVsnd2lkdGgnXVxuICAgICAgICAgICAgICAgICAgICBpbWcuaGVpZ2h0ID0gaW1nW3RoaXMubWluaW1hbFF1YWxpdHlDYXRlZ29yeV1bJ2hlaWdodCddXG4gICAgICAgICAgICAgICAgICAgIG1heGltdW1HYWxsZXJ5SW1hZ2VIZWlnaHQgPSBNYXRoLm1heChtYXhpbXVtR2FsbGVyeUltYWdlSGVpZ2h0LCBpbWdbJ2hlaWdodCddKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNoZWNrRm9yQXN5bmNMb2FkaW5nKGltZywgaW1hZ2VDb3VudGVyKyspXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcblxuICAgICAgICB0aGlzLm1pbmltYWxRdWFsaXR5Q2F0ZWdvcnkgPSBtYXhpbXVtR2FsbGVyeUltYWdlSGVpZ2h0ID4gMzc1ID8gJ3ByZXZpZXdfeHMnIDogJ3ByZXZpZXdfeHhzJ1xuICAgICAgICB0aGlzLnJlZnJlc2hOYXZpZ2F0aW9uRXJyb3JTdGF0ZSgpXG5cbiAgICAgICAgdGhpcy5jaGFuZ2VEZXRlY3RvclJlZi5kZXRlY3RDaGFuZ2VzKClcbiAgICB9XG5cbiAgICBwcml2YXRlIGNoZWNrRm9yQXN5bmNMb2FkaW5nKGltYWdlOiBhbnksIGltYWdlQ291bnRlcjogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IGltYWdlRWxlbWVudHMgPSB0aGlzLmltYWdlRWxlbWVudHMudG9BcnJheSgpXG5cbiAgICAgICAgaWYgKGltYWdlWydnYWxsZXJ5SW1hZ2VMb2FkZWQnXSB8fFxuICAgICAgICAgICAgKGltYWdlRWxlbWVudHMubGVuZ3RoID4gMCAmJlxuICAgICAgICAgICAgICBpbWFnZUVsZW1lbnRzW2ltYWdlQ291bnRlcl0gJiZcbiAgICAgICAgICAgICAgdGhpcy5pc1Njcm9sbGVkSW50b1ZpZXcoaW1hZ2VFbGVtZW50c1tpbWFnZUNvdW50ZXJdLm5hdGl2ZUVsZW1lbnQpKSkge1xuICAgICAgICAgICAgaW1hZ2VbJ2dhbGxlcnlJbWFnZUxvYWRlZCddID0gdHJ1ZVxuICAgICAgICAgICAgaW1hZ2VbJ3NyY0FmdGVyRm9jdXMnXSA9IGltYWdlW3RoaXMubWluaW1hbFF1YWxpdHlDYXRlZ29yeV1bJ3BhdGgnXVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaW1hZ2VbJ3NyY0FmdGVyRm9jdXMnXSA9ICcnXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGlzU2Nyb2xsZWRJbnRvVmlldyhlbGVtZW50OiBhbnkpOiBib29sZWFuIHtcbiAgICAgICAgY29uc3QgZWxlbWVudFRvcCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wXG4gICAgICAgIGNvbnN0IGVsZW1lbnRCb3R0b20gPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmJvdHRvbVxuXG4gICAgICAgIHJldHVybiBlbGVtZW50VG9wIDwgd2luZG93LmlubmVySGVpZ2h0ICYmIGVsZW1lbnRCb3R0b20gPj0gMCAmJiAoZWxlbWVudEJvdHRvbSA+IDAgfHwgZWxlbWVudFRvcCA+IDApXG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZWZyZXNoTmF2aWdhdGlvbkVycm9yU3RhdGUoKTogdm9pZCB7XG4gICAgICAgIHRoaXMubGVmdEFycm93SW5hY3RpdmUgPSB0aGlzLnJvd0luZGV4ID09IDBcbiAgICAgICAgdGhpcy5yaWdodEFycm93SW5hY3RpdmUgPSB0aGlzLnJvd0luZGV4ID4gKHRoaXMuZ2FsbGVyeS5sZW5ndGggLSB0aGlzLnJvd3NQZXJQYWdlKVxuICAgIH1cbn1cbiJdfQ==