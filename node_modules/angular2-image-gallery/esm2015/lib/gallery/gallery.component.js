/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { ChangeDetectorRef, Component, ElementRef, EventEmitter, HostListener, Input, Output, QueryList, ViewChild, ViewChildren } from '@angular/core';
import { ImageService } from '../services/image.service';
import { HttpClient } from '@angular/common/http';
export class GalleryComponent {
    /**
     * @param {?} imageService
     * @param {?} http
     * @param {?} changeDetectorRef
     */
    constructor(imageService, http, changeDetectorRef) {
        this.imageService = imageService;
        this.http = http;
        this.changeDetectorRef = changeDetectorRef;
        this.gallery = [];
        this.imageDataStaticPath = 'assets/img/gallery/';
        this.imageDataCompletePath = '';
        this.dataFileName = 'data.json';
        this.images = [];
        this.minimalQualityCategory = 'preview_xxs';
        this.rowIndex = 0;
        this.rightArrowInactive = false;
        this.leftArrowInactive = false;
        this.providedImageMargin = 3;
        this.providedImageSize = 7;
        this.providedGalleryName = '';
        this.providedMetadataUri = undefined;
        this.rowsPerPage = 200;
        this.viewerChange = new EventEmitter();
    }
    /**
     * @param {?} event
     * @return {?}
     */
    triggerCycle(event) {
        this.scaleGallery();
    }
    /**
     * @param {?} event
     * @return {?}
     */
    windowResize(event) {
        this.render();
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.fetchDataAndRender();
        this.viewerSubscription = this.imageService.showImageViewerChanged$
            .subscribe((visibility) => this.viewerChange.emit(visibility));
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        // input params changed
        if (changes['providedGalleryName'] != undefined) {
            this.fetchDataAndRender();
        }
        else {
            this.render();
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.viewerSubscription) {
            this.viewerSubscription.unsubscribe();
        }
    }
    /**
     * @param {?} img
     * @return {?}
     */
    openImageViewer(img) {
        this.imageService.updateImages(this.images);
        this.imageService.updateSelectedImageIndex(this.images.indexOf(img));
        this.imageService.showImageViewer(true);
    }
    /**
     * direction (-1: left, 1: right)
     * @param {?} direction
     * @return {?}
     */
    navigate(direction) {
        if ((direction === 1 && this.rowIndex < this.gallery.length - this.rowsPerPage)
            || (direction === -1 && this.rowIndex > 0)) {
            this.rowIndex += (this.rowsPerPage * direction);
        }
        this.refreshNavigationErrorState();
    }
    /**
     * @return {?}
     */
    calcImageMargin() {
        const /** @type {?} */ galleryWidth = this.getGalleryWidth();
        const /** @type {?} */ ratio = galleryWidth / 1920;
        return Math.round(Math.max(1, this.providedImageMargin * ratio));
    }
    /**
     * @return {?}
     */
    fetchDataAndRender() {
        this.imageDataCompletePath = this.providedMetadataUri;
        if (!this.providedMetadataUri) {
            this.imageDataCompletePath = this.providedGalleryName !== '' ?
                `${this.imageDataStaticPath + this.providedGalleryName}/${this.dataFileName}` :
                this.imageDataStaticPath + this.dataFileName;
        }
        this.http.get(this.imageDataCompletePath)
            .subscribe((data) => {
            this.images = data;
            this.imageService.updateImages(this.images);
            this.images.forEach(image => {
                image['galleryImageLoaded'] = false;
                image['viewerImageLoaded'] = false;
                image['srcAfterFocus'] = '';
            });
            // twice, single leads to different strange browser behaviour
            this.render();
            this.render();
        }, err => {
            if (this.providedMetadataUri) {
                console.error(`Provided endpoint '${this.providedMetadataUri}' did not serve metadata correctly or in the expected format.
      See here for more information: https://github.com/BenjaminBrandmeier/angular2-image-gallery/blob/master/docs/externalDataSource.md,
      Original error: ${err}`);
            }
            else {
                console.error(`Did you run the convert script from angular2-image-gallery for your images first? Original error: ${err}`);
            }
        }, () => undefined);
    }
    /**
     * @return {?}
     */
    render() {
        this.gallery = [];
        let /** @type {?} */ tempRow = [this.images[0]];
        let /** @type {?} */ currentRowIndex = 0;
        let /** @type {?} */ i = 0;
        for (i; i < this.images.length; i++) {
            while (this.images[i + 1] && this.shouldAddCandidate(tempRow, this.images[i + 1])) {
                i++;
            }
            if (this.images[i + 1]) {
                tempRow.pop();
            }
            this.gallery[currentRowIndex++] = tempRow;
            tempRow = [this.images[i + 1]];
        }
        this.scaleGallery();
    }
    /**
     * @param {?} imgRow
     * @param {?} candidate
     * @return {?}
     */
    shouldAddCandidate(imgRow, candidate) {
        const /** @type {?} */ oldDifference = this.calcIdealHeight() - this.calcRowHeight(imgRow);
        imgRow.push(candidate);
        const /** @type {?} */ newDifference = this.calcIdealHeight() - this.calcRowHeight(imgRow);
        return Math.abs(oldDifference) > Math.abs(newDifference);
    }
    /**
     * @param {?} imgRow
     * @return {?}
     */
    calcRowHeight(imgRow) {
        const /** @type {?} */ originalRowWidth = this.calcOriginalRowWidth(imgRow);
        const /** @type {?} */ ratio = (this.getGalleryWidth() - (imgRow.length - 1) * this.calcImageMargin()) / originalRowWidth;
        const /** @type {?} */ rowHeight = imgRow[0][this.minimalQualityCategory]['height'] * ratio;
        return rowHeight;
    }
    /**
     * @param {?} imgRow
     * @return {?}
     */
    calcOriginalRowWidth(imgRow) {
        let /** @type {?} */ originalRowWidth = 0;
        imgRow.forEach(img => {
            const /** @type {?} */ individualRatio = this.calcIdealHeight() / img[this.minimalQualityCategory]['height'];
            img[this.minimalQualityCategory]['width'] = img[this.minimalQualityCategory]['width'] * individualRatio;
            img[this.minimalQualityCategory]['height'] = this.calcIdealHeight();
            originalRowWidth += img[this.minimalQualityCategory]['width'];
        });
        return originalRowWidth;
    }
    /**
     * @return {?}
     */
    calcIdealHeight() {
        return this.getGalleryWidth() / (80 / this.providedImageSize) + 100;
    }
    /**
     * @return {?}
     */
    getGalleryWidth() {
        if (this.galleryContainer.nativeElement.clientWidth === 0) {
            // for IE11
            return this.galleryContainer.nativeElement.scrollWidth;
        }
        return this.galleryContainer.nativeElement.clientWidth;
    }
    /**
     * @return {?}
     */
    scaleGallery() {
        let /** @type {?} */ imageCounter = 0;
        let /** @type {?} */ maximumGalleryImageHeight = 0;
        this.gallery.slice(this.rowIndex, this.rowIndex + this.rowsPerPage)
            .forEach(imgRow => {
            const /** @type {?} */ originalRowWidth = this.calcOriginalRowWidth(imgRow);
            if (imgRow !== this.gallery[this.gallery.length - 1]) {
                const /** @type {?} */ ratio = (this.getGalleryWidth() - (imgRow.length - 1) * this.calcImageMargin()) / originalRowWidth;
                imgRow.forEach((img) => {
                    img['width'] = img[this.minimalQualityCategory]['width'] * ratio;
                    img['height'] = img[this.minimalQualityCategory]['height'] * ratio;
                    maximumGalleryImageHeight = Math.max(maximumGalleryImageHeight, img['height']);
                    this.checkForAsyncLoading(img, imageCounter++);
                });
            }
            else {
                imgRow.forEach((img) => {
                    img.width = img[this.minimalQualityCategory]['width'];
                    img.height = img[this.minimalQualityCategory]['height'];
                    maximumGalleryImageHeight = Math.max(maximumGalleryImageHeight, img['height']);
                    this.checkForAsyncLoading(img, imageCounter++);
                });
            }
        });
        this.minimalQualityCategory = maximumGalleryImageHeight > 375 ? 'preview_xs' : 'preview_xxs';
        this.refreshNavigationErrorState();
        this.changeDetectorRef.detectChanges();
    }
    /**
     * @param {?} image
     * @param {?} imageCounter
     * @return {?}
     */
    checkForAsyncLoading(image, imageCounter) {
        const /** @type {?} */ imageElements = this.imageElements.toArray();
        if (image['galleryImageLoaded'] ||
            (imageElements.length > 0 &&
                imageElements[imageCounter] &&
                this.isScrolledIntoView(imageElements[imageCounter].nativeElement))) {
            image['galleryImageLoaded'] = true;
            image['srcAfterFocus'] = image[this.minimalQualityCategory]['path'];
        }
        else {
            image['srcAfterFocus'] = '';
        }
    }
    /**
     * @param {?} element
     * @return {?}
     */
    isScrolledIntoView(element) {
        const /** @type {?} */ elementTop = element.getBoundingClientRect().top;
        const /** @type {?} */ elementBottom = element.getBoundingClientRect().bottom;
        return elementTop < window.innerHeight && elementBottom >= 0 && (elementBottom > 0 || elementTop > 0);
    }
    /**
     * @return {?}
     */
    refreshNavigationErrorState() {
        this.leftArrowInactive = this.rowIndex == 0;
        this.rightArrowInactive = this.rowIndex > (this.gallery.length - this.rowsPerPage);
    }
}
GalleryComponent.decorators = [
    { type: Component, args: [{
                selector: 'gallery',
                template: `<div #galleryContainer class="galleryContainer">
    <div class="innerGalleryContainer">
        <div *ngFor='let imgrow of gallery | slice:rowIndex:rowIndex+rowsPerPage; let i = index'
             class="imagerow"
             [style.margin-bottom.px]="calcImageMargin()">
            <img #imageElement
                 *ngFor='let img of imgrow; let j = index'
                 class="thumbnail"
                 [style.width.px]="img['width']"
                 [style.height.px]="img['height']"
                 (click)="openImageViewer(img)"
                 [src]="img['srcAfterFocus']"
                 [style.background]="img.dominantColor"
                 [style.margin-right.px]="calcImageMargin()"/>
        </div>
    </div>

    <div class="pagerContainer" *ngIf="(!rightArrowInactive || !leftArrowInactive)">
        <img [ngClass]="{'inactive': leftArrowInactive}" class="pager left"
             src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgaWQ9IkxheWVyXzEiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDQ4IDQ4OyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgNDggNDgiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxnPjxwYXRoIGQ9Ik0yNCw0NkMxMS45LDQ2LDIsMzYuMSwyLDI0UzExLjksMiwyNCwyczIyLDkuOSwyMiwyMlMzNi4xLDQ2LDI0LDQ2eiBNMjQsNEMxMyw0LDQsMTMsNCwyNGMwLDExLDksMjAsMjAsMjAgICBjMTEsMCwyMC05LDIwLTIwQzQ0LDEzLDM1LDQsMjQsNHoiLz48L2c+PGc+PHBvbHlnb24gcG9pbnRzPSIyNy42LDM2LjcgMTQuOSwyNCAyNy42LDExLjMgMjkuMSwxMi43IDE3LjgsMjQgMjkuMSwzNS4zICAiLz48L2c+PC9zdmc+"
             (click)="navigate(-1)"/>
        <img [ngClass]="{'inactive': rightArrowInactive}" class="pager right"
             src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgaWQ9IkxheWVyXzEiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDQ4IDQ4OyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgNDggNDgiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxnPjxwYXRoIGQ9Ik0yNCw0NkMxMS45LDQ2LDIsMzYuMSwyLDI0UzExLjksMiwyNCwyczIyLDkuOSwyMiwyMlMzNi4xLDQ2LDI0LDQ2eiBNMjQsNEMxMyw0LDQsMTMsNCwyNHM5LDIwLDIwLDIwczIwLTksMjAtMjAgICBTMzUsNCwyNCw0eiIvPjwvZz48Zz48cG9seWdvbiBwb2ludHM9IjIxLjQsMzYuNyAxOS45LDM1LjMgMzEuMiwyNCAxOS45LDEyLjcgMjEuNCwxMS4zIDM0LjEsMjQgICIvPjwvZz48L3N2Zz4="
             (click)="navigate(1)"/>
    </div>
</div>

<viewer></viewer>
`,
                styles: [`.innerGalleryContainer{position:relative}.galleryContainer{height:100%;width:100%;overflow:hidden}.innerGalleryContainer img:last-child{margin-right:-1px!important}.galleryContainer img:hover{-webkit-filter:brightness(50%);filter:brightness(50%);transition:all ease-out .2s;cursor:pointer}.imagerow{margin-right:1px;overflow:hidden;display:flex}::-webkit-scrollbar{display:none}.asyncLoadingContainer{position:absolute;background-color:transparent;height:0;width:0;bottom:120px}.pagerContainer{margin:40px auto;width:180px}.pager{display:block;height:60px}@media (max-width:700px){.pagerContainer{margin:40px auto;width:150px}.pager{display:block;height:45px}}.pager.inactive{opacity:.15}.pager.left{float:left}.pager.right{float:right}`]
            },] },
];
/** @nocollapse */
GalleryComponent.ctorParameters = () => [
    { type: ImageService },
    { type: HttpClient },
    { type: ChangeDetectorRef }
];
GalleryComponent.propDecorators = {
    providedImageMargin: [{ type: Input, args: ['flexBorderSize',] }],
    providedImageSize: [{ type: Input, args: ['flexImageSize',] }],
    providedGalleryName: [{ type: Input, args: ['galleryName',] }],
    providedMetadataUri: [{ type: Input, args: ['metadataUri',] }],
    rowsPerPage: [{ type: Input, args: ['maxRowsPerPage',] }],
    viewerChange: [{ type: Output }],
    galleryContainer: [{ type: ViewChild, args: ['galleryContainer',] }],
    imageElements: [{ type: ViewChildren, args: ['imageElement',] }],
    triggerCycle: [{ type: HostListener, args: ['window:scroll', ['$event'],] }],
    windowResize: [{ type: HostListener, args: ['window:resize', ['$event'],] }]
};
function GalleryComponent_tsickle_Closure_declarations() {
    /** @type {?} */
    GalleryComponent.prototype.gallery;
    /** @type {?} */
    GalleryComponent.prototype.imageDataStaticPath;
    /** @type {?} */
    GalleryComponent.prototype.imageDataCompletePath;
    /** @type {?} */
    GalleryComponent.prototype.dataFileName;
    /** @type {?} */
    GalleryComponent.prototype.images;
    /** @type {?} */
    GalleryComponent.prototype.minimalQualityCategory;
    /** @type {?} */
    GalleryComponent.prototype.viewerSubscription;
    /** @type {?} */
    GalleryComponent.prototype.rowIndex;
    /** @type {?} */
    GalleryComponent.prototype.rightArrowInactive;
    /** @type {?} */
    GalleryComponent.prototype.leftArrowInactive;
    /** @type {?} */
    GalleryComponent.prototype.providedImageMargin;
    /** @type {?} */
    GalleryComponent.prototype.providedImageSize;
    /** @type {?} */
    GalleryComponent.prototype.providedGalleryName;
    /** @type {?} */
    GalleryComponent.prototype.providedMetadataUri;
    /** @type {?} */
    GalleryComponent.prototype.rowsPerPage;
    /** @type {?} */
    GalleryComponent.prototype.viewerChange;
    /** @type {?} */
    GalleryComponent.prototype.galleryContainer;
    /** @type {?} */
    GalleryComponent.prototype.imageElements;
    /** @type {?} */
    GalleryComponent.prototype.imageService;
    /** @type {?} */
    GalleryComponent.prototype.http;
    /** @type {?} */
    GalleryComponent.prototype.changeDetectorRef;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2FsbGVyeS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmd1bGFyMi1pbWFnZS1nYWxsZXJ5LyIsInNvdXJjZXMiOlsibGliL2dhbGxlcnkvZ2FsbGVyeS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFDTCxpQkFBaUIsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxZQUFZLEVBQ3BFLEtBQUssRUFBZ0MsTUFBTSxFQUFFLFNBQVMsRUFBaUIsU0FBUyxFQUFFLFlBQVksRUFDL0YsTUFBTSxlQUFlLENBQUE7QUFDdEIsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDJCQUEyQixDQUFBO0FBRXhELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQTtBQW1DakQsTUFBTTs7Ozs7O0lBK0JGLFlBQW1CLFlBQTBCLEVBQVMsSUFBZ0IsRUFBUyxpQkFBb0M7UUFBaEcsaUJBQVksR0FBWixZQUFZLENBQWM7UUFBUyxTQUFJLEdBQUosSUFBSSxDQUFZO1FBQVMsc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFtQjt1QkE5QjdGLEVBQUU7bUNBQ00scUJBQXFCO3FDQUNuQixFQUFFOzRCQUNYLFdBQVc7c0JBQ2IsRUFBRTtzQ0FDRSxhQUFhO3dCQUVuQixDQUFDO2tDQUNVLEtBQUs7aUNBQ04sS0FBSzttQ0FFcUIsQ0FBQztpQ0FDSixDQUFDO21DQUNELEVBQUU7bUNBQ0YsU0FBUzsyQkFDZCxHQUFHOzRCQUV6QixJQUFJLFlBQVksRUFBVztLQWNuRDs7Ozs7SUFUMEMsWUFBWSxDQUFDLEtBQVU7UUFDOUQsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFBO0tBQ3RCOzs7OztJQUUwQyxZQUFZLENBQUMsS0FBVTtRQUM5RCxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUE7S0FDaEI7Ozs7SUFLRCxRQUFRO1FBQ0osSUFBSSxDQUFDLGtCQUFrQixFQUFFLENBQUE7UUFDekIsSUFBSSxDQUFDLGtCQUFrQixHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsdUJBQXVCO2FBQzlELFNBQVMsQ0FBQyxDQUFDLFVBQW1CLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUE7S0FDOUU7Ozs7O0lBRUQsV0FBVyxDQUFDLE9BQXNCOztRQUU5QixFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMscUJBQXFCLENBQUMsSUFBSSxTQUFTLENBQUMsQ0FBQyxDQUFDO1lBQzlDLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFBO1NBQzVCO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDSixJQUFJLENBQUMsTUFBTSxFQUFFLENBQUE7U0FDaEI7S0FDSjs7OztJQUVELFdBQVc7UUFDUCxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxDQUFDO1lBQzFCLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxXQUFXLEVBQUUsQ0FBQTtTQUN4QztLQUNKOzs7OztJQUVELGVBQWUsQ0FBQyxHQUFRO1FBQ3BCLElBQUksQ0FBQyxZQUFZLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQTtRQUMzQyxJQUFJLENBQUMsWUFBWSxDQUFDLHdCQUF3QixDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUE7UUFDcEUsSUFBSSxDQUFDLFlBQVksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUE7S0FDMUM7Ozs7OztJQUtELFFBQVEsQ0FBQyxTQUFpQjtRQUN0QixFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVMsS0FBSyxDQUFDLElBQUksSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDO2VBQ3hFLENBQUMsU0FBUyxLQUFLLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQyxRQUFRLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzdDLElBQUksQ0FBQyxRQUFRLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxHQUFHLFNBQVMsQ0FBQyxDQUFBO1NBQ2xEO1FBQ0QsSUFBSSxDQUFDLDJCQUEyQixFQUFFLENBQUE7S0FDckM7Ozs7SUFFRCxlQUFlO1FBQ1gsdUJBQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQTtRQUMzQyx1QkFBTSxLQUFLLEdBQUcsWUFBWSxHQUFHLElBQUksQ0FBQTtRQUNqQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsbUJBQW1CLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQTtLQUNuRTs7OztJQUVPLGtCQUFrQjtRQUN0QixJQUFJLENBQUMscUJBQXFCLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFBO1FBRXJELEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLENBQUMsQ0FBQztZQUM1QixJQUFJLENBQUMscUJBQXFCLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixLQUFLLEVBQUUsQ0FBQyxDQUFDO2dCQUMxRCxHQUFHLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLENBQUMsbUJBQW1CLElBQUksSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDLENBQUM7Z0JBQy9FLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFBO1NBQ25EO1FBRUQsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLHFCQUFxQixDQUFDO2FBQ3RDLFNBQVMsQ0FDUixDQUFDLElBQWdCLEVBQUUsRUFBRTtZQUNiLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFBO1lBQ2xCLElBQUksQ0FBQyxZQUFZLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQTtZQUUzQyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsRUFBRTtnQkFDMUIsS0FBSyxDQUFDLG9CQUFvQixDQUFDLEdBQUcsS0FBSyxDQUFBO2dCQUNuQyxLQUFLLENBQUMsbUJBQW1CLENBQUMsR0FBRyxLQUFLLENBQUE7Z0JBQ2xDLEtBQUssQ0FBQyxlQUFlLENBQUMsR0FBRyxFQUFFLENBQUE7YUFDNUIsQ0FBQyxDQUFBOztZQUVGLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQTtZQUNiLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQTtTQUNoQixFQUNILEdBQUcsQ0FBQyxFQUFFO1lBQ0EsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLENBQUMsQ0FBQztnQkFDN0IsT0FBTyxDQUFDLEtBQUssQ0FBQyxzQkFBc0IsSUFBSSxDQUFDLG1CQUFtQjs7d0JBRTFELEdBQUcsRUFBRSxDQUFDLENBQUE7YUFDVDtZQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNKLE9BQU8sQ0FBQyxLQUFLLENBQUMscUdBQXFHLEdBQUcsRUFBRSxDQUFDLENBQUE7YUFDNUg7U0FDTixFQUNILEdBQUcsRUFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFBOzs7OztJQUdoQixNQUFNO1FBQ1YsSUFBSSxDQUFDLE9BQU8sR0FBRyxFQUFFLENBQUE7UUFFakIscUJBQUksT0FBTyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBQzlCLHFCQUFJLGVBQWUsR0FBRyxDQUFDLENBQUE7UUFDdkIscUJBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUVULEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUNsQyxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO2dCQUNoRixDQUFDLEVBQUUsQ0FBQTthQUNOO1lBQ0QsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNyQixPQUFPLENBQUMsR0FBRyxFQUFFLENBQUE7YUFDaEI7WUFDRCxJQUFJLENBQUMsT0FBTyxDQUFDLGVBQWUsRUFBRSxDQUFDLEdBQUcsT0FBTyxDQUFBO1lBRXpDLE9BQU8sR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUE7U0FDakM7UUFFRCxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUE7Ozs7Ozs7SUFHZixrQkFBa0IsQ0FBQyxNQUFrQixFQUFFLFNBQWM7UUFDekQsdUJBQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxlQUFlLEVBQUUsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFBO1FBQ3pFLE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUE7UUFDdEIsdUJBQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxlQUFlLEVBQUUsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFBO1FBRXpFLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLENBQUE7Ozs7OztJQUdwRCxhQUFhLENBQUMsTUFBa0I7UUFDcEMsdUJBQU0sZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLG9CQUFvQixDQUFDLE1BQU0sQ0FBQyxDQUFBO1FBRTFELHVCQUFNLEtBQUssR0FBRyxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDLEdBQUcsZ0JBQWdCLENBQUE7UUFDeEcsdUJBQU0sU0FBUyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxRQUFRLENBQUMsR0FBRyxLQUFLLENBQUE7UUFFMUUsTUFBTSxDQUFDLFNBQVMsQ0FBQTs7Ozs7O0lBR1osb0JBQW9CLENBQUMsTUFBa0I7UUFDM0MscUJBQUksZ0JBQWdCLEdBQUcsQ0FBQyxDQUFBO1FBQ3hCLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDakIsdUJBQU0sZUFBZSxHQUFHLElBQUksQ0FBQyxlQUFlLEVBQUUsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLENBQUMsUUFBUSxDQUFDLENBQUE7WUFDM0YsR0FBRyxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxlQUFlLENBQUE7WUFDdkcsR0FBRyxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxHQUFHLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQTtZQUNuRSxnQkFBZ0IsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLENBQUMsT0FBTyxDQUFDLENBQUE7U0FDaEUsQ0FBQyxDQUFBO1FBRUYsTUFBTSxDQUFDLGdCQUFnQixDQUFBOzs7OztJQUduQixlQUFlO1FBQ25CLE1BQU0sQ0FBQyxJQUFJLENBQUMsZUFBZSxFQUFFLEdBQUcsQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsR0FBRyxDQUFBOzs7OztJQUcvRCxlQUFlO1FBQ25CLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxhQUFhLENBQUMsV0FBVyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7O1lBRXhELE1BQU0sQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQTtTQUN6RDtRQUNELE1BQU0sQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQTs7Ozs7SUFHbEQsWUFBWTtRQUNoQixxQkFBSSxZQUFZLEdBQUcsQ0FBQyxDQUFBO1FBQ3BCLHFCQUFJLHlCQUF5QixHQUFHLENBQUMsQ0FBQTtRQUVqQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQzthQUNoRSxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUU7WUFDaEIsdUJBQU0sZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLG9CQUFvQixDQUFDLE1BQU0sQ0FBQyxDQUFBO1lBRTFELEVBQUUsQ0FBQyxDQUFDLE1BQU0sS0FBSyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDbkQsdUJBQU0sS0FBSyxHQUFHLENBQUMsSUFBSSxDQUFDLGVBQWUsRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUMsR0FBRyxnQkFBZ0IsQ0FBQTtnQkFFeEcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQVEsRUFBRSxFQUFFO29CQUN4QixHQUFHLENBQUMsT0FBTyxDQUFDLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEtBQUssQ0FBQTtvQkFDaEUsR0FBRyxDQUFDLFFBQVEsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxRQUFRLENBQUMsR0FBRyxLQUFLLENBQUE7b0JBQ2xFLHlCQUF5QixHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMseUJBQXlCLEVBQUUsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUE7b0JBQzlFLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxHQUFHLEVBQUUsWUFBWSxFQUFFLENBQUMsQ0FBQTtpQkFDakQsQ0FBQyxDQUFBO2FBQ0w7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDSixNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsR0FBUSxFQUFFLEVBQUU7b0JBQ3hCLEdBQUcsQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFBO29CQUNyRCxHQUFHLENBQUMsTUFBTSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQTtvQkFDdkQseUJBQXlCLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyx5QkFBeUIsRUFBRSxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQTtvQkFDOUUsSUFBSSxDQUFDLG9CQUFvQixDQUFDLEdBQUcsRUFBRSxZQUFZLEVBQUUsQ0FBQyxDQUFBO2lCQUNqRCxDQUFDLENBQUE7YUFDTDtTQUNKLENBQUMsQ0FBQTtRQUVGLElBQUksQ0FBQyxzQkFBc0IsR0FBRyx5QkFBeUIsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFBO1FBQzVGLElBQUksQ0FBQywyQkFBMkIsRUFBRSxDQUFBO1FBRWxDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxhQUFhLEVBQUUsQ0FBQTs7Ozs7OztJQUdsQyxvQkFBb0IsQ0FBQyxLQUFVLEVBQUUsWUFBb0I7UUFDekQsdUJBQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsT0FBTyxFQUFFLENBQUE7UUFFbEQsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLG9CQUFvQixDQUFDO1lBQzNCLENBQUMsYUFBYSxDQUFDLE1BQU0sR0FBRyxDQUFDO2dCQUN2QixhQUFhLENBQUMsWUFBWSxDQUFDO2dCQUMzQixJQUFJLENBQUMsa0JBQWtCLENBQUMsYUFBYSxDQUFDLFlBQVksQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3hFLEtBQUssQ0FBQyxvQkFBb0IsQ0FBQyxHQUFHLElBQUksQ0FBQTtZQUNsQyxLQUFLLENBQUMsZUFBZSxDQUFDLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFBO1NBQ3RFO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDSixLQUFLLENBQUMsZUFBZSxDQUFDLEdBQUcsRUFBRSxDQUFBO1NBQzlCOzs7Ozs7SUFHRyxrQkFBa0IsQ0FBQyxPQUFZO1FBQ25DLHVCQUFNLFVBQVUsR0FBRyxPQUFPLENBQUMscUJBQXFCLEVBQUUsQ0FBQyxHQUFHLENBQUE7UUFDdEQsdUJBQU0sYUFBYSxHQUFHLE9BQU8sQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLE1BQU0sQ0FBQTtRQUU1RCxNQUFNLENBQUMsVUFBVSxHQUFHLE1BQU0sQ0FBQyxXQUFXLElBQUksYUFBYSxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsR0FBRyxDQUFDLElBQUksVUFBVSxHQUFHLENBQUMsQ0FBQyxDQUFBOzs7OztJQUdqRywyQkFBMkI7UUFDL0IsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksQ0FBQyxRQUFRLElBQUksQ0FBQyxDQUFBO1FBQzNDLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLENBQUMsUUFBUSxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFBOzs7O1lBMVF6RixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLFNBQVM7Z0JBQ25CLFFBQVEsRUFBRTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztDQTRCYjtnQkFDRyxNQUFNLEVBQUUsQ0FBQyxrdUJBQWt1QixDQUFDO2FBQy91Qjs7OztZQXBDUSxZQUFZO1lBRVosVUFBVTtZQUxqQixpQkFBaUI7OztrQ0FvRGQsS0FBSyxTQUFDLGdCQUFnQjtnQ0FDdEIsS0FBSyxTQUFDLGVBQWU7a0NBQ3JCLEtBQUssU0FBQyxhQUFhO2tDQUNuQixLQUFLLFNBQUMsYUFBYTswQkFDbkIsS0FBSyxTQUFDLGdCQUFnQjsyQkFFdEIsTUFBTTsrQkFFTixTQUFTLFNBQUMsa0JBQWtCOzRCQUM1QixZQUFZLFNBQUMsY0FBYzsyQkFFM0IsWUFBWSxTQUFDLGVBQWUsRUFBRSxDQUFDLFFBQVEsQ0FBQzsyQkFJeEMsWUFBWSxTQUFDLGVBQWUsRUFBRSxDQUFDLFFBQVEsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENoYW5nZURldGVjdG9yUmVmLCBDb21wb25lbnQsIEVsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciwgSG9zdExpc3RlbmVyLFxuICBJbnB1dCwgT25DaGFuZ2VzLCBPbkRlc3Ryb3ksIE9uSW5pdCwgT3V0cHV0LCBRdWVyeUxpc3QsIFNpbXBsZUNoYW5nZXMsIFZpZXdDaGlsZCwgVmlld0NoaWxkcmVuXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnXG5pbXBvcnQgeyBJbWFnZVNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9pbWFnZS5zZXJ2aWNlJ1xuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcy9pbnRlcm5hbC9TdWJzY3JpcHRpb24nXG5pbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnXG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnZ2FsbGVyeScsXG4gICAgdGVtcGxhdGU6IGA8ZGl2ICNnYWxsZXJ5Q29udGFpbmVyIGNsYXNzPVwiZ2FsbGVyeUNvbnRhaW5lclwiPlxuICAgIDxkaXYgY2xhc3M9XCJpbm5lckdhbGxlcnlDb250YWluZXJcIj5cbiAgICAgICAgPGRpdiAqbmdGb3I9J2xldCBpbWdyb3cgb2YgZ2FsbGVyeSB8IHNsaWNlOnJvd0luZGV4OnJvd0luZGV4K3Jvd3NQZXJQYWdlOyBsZXQgaSA9IGluZGV4J1xuICAgICAgICAgICAgIGNsYXNzPVwiaW1hZ2Vyb3dcIlxuICAgICAgICAgICAgIFtzdHlsZS5tYXJnaW4tYm90dG9tLnB4XT1cImNhbGNJbWFnZU1hcmdpbigpXCI+XG4gICAgICAgICAgICA8aW1nICNpbWFnZUVsZW1lbnRcbiAgICAgICAgICAgICAgICAgKm5nRm9yPSdsZXQgaW1nIG9mIGltZ3JvdzsgbGV0IGogPSBpbmRleCdcbiAgICAgICAgICAgICAgICAgY2xhc3M9XCJ0aHVtYm5haWxcIlxuICAgICAgICAgICAgICAgICBbc3R5bGUud2lkdGgucHhdPVwiaW1nWyd3aWR0aCddXCJcbiAgICAgICAgICAgICAgICAgW3N0eWxlLmhlaWdodC5weF09XCJpbWdbJ2hlaWdodCddXCJcbiAgICAgICAgICAgICAgICAgKGNsaWNrKT1cIm9wZW5JbWFnZVZpZXdlcihpbWcpXCJcbiAgICAgICAgICAgICAgICAgW3NyY109XCJpbWdbJ3NyY0FmdGVyRm9jdXMnXVwiXG4gICAgICAgICAgICAgICAgIFtzdHlsZS5iYWNrZ3JvdW5kXT1cImltZy5kb21pbmFudENvbG9yXCJcbiAgICAgICAgICAgICAgICAgW3N0eWxlLm1hcmdpbi1yaWdodC5weF09XCJjYWxjSW1hZ2VNYXJnaW4oKVwiLz5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG5cbiAgICA8ZGl2IGNsYXNzPVwicGFnZXJDb250YWluZXJcIiAqbmdJZj1cIighcmlnaHRBcnJvd0luYWN0aXZlIHx8ICFsZWZ0QXJyb3dJbmFjdGl2ZSlcIj5cbiAgICAgICAgPGltZyBbbmdDbGFzc109XCJ7J2luYWN0aXZlJzogbGVmdEFycm93SW5hY3RpdmV9XCIgY2xhc3M9XCJwYWdlciBsZWZ0XCJcbiAgICAgICAgICAgICBzcmM9XCJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBEOTRiV3dnZG1WeWMybHZiajBpTVM0d0lpQS9Qanh6ZG1jZ2FXUTlJa3hoZVdWeVh6RWlJSE4wZVd4bFBTSmxibUZpYkdVdFltRmphMmR5YjNWdVpEcHVaWGNnTUNBd0lEUTRJRFE0T3lJZ2RtVnljMmx2YmowaU1TNHhJaUIyYVdWM1FtOTRQU0l3SURBZ05EZ2dORGdpSUhodGJEcHpjR0ZqWlQwaWNISmxjMlZ5ZG1VaUlIaHRiRzV6UFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eU1EQXdMM04yWnlJZ2VHMXNibk02ZUd4cGJtczlJbWgwZEhBNkx5OTNkM2N1ZHpNdWIzSm5MekU1T1RrdmVHeHBibXNpUGp4blBqeHdZWFJvSUdROUlrMHlOQ3cwTmtNeE1TNDVMRFEyTERJc016WXVNU3d5TERJMFV6RXhMamtzTWl3eU5Dd3ljekl5TERrdU9Td3lNaXd5TWxNek5pNHhMRFEyTERJMExEUTJlaUJOTWpRc05FTXhNeXcwTERRc01UTXNOQ3d5TkdNd0xERXhMRGtzTWpBc01qQXNNakFnSUNCak1URXNNQ3d5TUMwNUxESXdMVEl3UXpRMExERXpMRE0xTERRc01qUXNOSG9pTHo0OEwyYytQR2MrUEhCdmJIbG5iMjRnY0c5cGJuUnpQU0l5Tnk0MkxETTJMamNnTVRRdU9Td3lOQ0F5Tnk0MkxERXhMak1nTWprdU1Td3hNaTQzSURFM0xqZ3NNalFnTWprdU1Td3pOUzR6SUNBaUx6NDhMMmMrUEM5emRtYytcIlxuICAgICAgICAgICAgIChjbGljayk9XCJuYXZpZ2F0ZSgtMSlcIi8+XG4gICAgICAgIDxpbWcgW25nQ2xhc3NdPVwieydpbmFjdGl2ZSc6IHJpZ2h0QXJyb3dJbmFjdGl2ZX1cIiBjbGFzcz1cInBhZ2VyIHJpZ2h0XCJcbiAgICAgICAgICAgICBzcmM9XCJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBEOTRiV3dnZG1WeWMybHZiajBpTVM0d0lpQS9Qanh6ZG1jZ2FXUTlJa3hoZVdWeVh6RWlJSE4wZVd4bFBTSmxibUZpYkdVdFltRmphMmR5YjNWdVpEcHVaWGNnTUNBd0lEUTRJRFE0T3lJZ2RtVnljMmx2YmowaU1TNHhJaUIyYVdWM1FtOTRQU0l3SURBZ05EZ2dORGdpSUhodGJEcHpjR0ZqWlQwaWNISmxjMlZ5ZG1VaUlIaHRiRzV6UFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eU1EQXdMM04yWnlJZ2VHMXNibk02ZUd4cGJtczlJbWgwZEhBNkx5OTNkM2N1ZHpNdWIzSm5MekU1T1RrdmVHeHBibXNpUGp4blBqeHdZWFJvSUdROUlrMHlOQ3cwTmtNeE1TNDVMRFEyTERJc016WXVNU3d5TERJMFV6RXhMamtzTWl3eU5Dd3ljekl5TERrdU9Td3lNaXd5TWxNek5pNHhMRFEyTERJMExEUTJlaUJOTWpRc05FTXhNeXcwTERRc01UTXNOQ3d5TkhNNUxESXdMREl3TERJd2N6SXdMVGtzTWpBdE1qQWdJQ0JUTXpVc05Dd3lOQ3cwZWlJdlBqd3ZaejQ4Wno0OGNHOXNlV2R2YmlCd2IybHVkSE05SWpJeExqUXNNell1TnlBeE9TNDVMRE0xTGpNZ016RXVNaXd5TkNBeE9TNDVMREV5TGpjZ01qRXVOQ3d4TVM0eklETTBMakVzTWpRZ0lDSXZQand2Wno0OEwzTjJaejQ9XCJcbiAgICAgICAgICAgICAoY2xpY2spPVwibmF2aWdhdGUoMSlcIi8+XG4gICAgPC9kaXY+XG48L2Rpdj5cblxuPHZpZXdlcj48L3ZpZXdlcj5cbmAsXG4gICAgc3R5bGVzOiBbYC5pbm5lckdhbGxlcnlDb250YWluZXJ7cG9zaXRpb246cmVsYXRpdmV9LmdhbGxlcnlDb250YWluZXJ7aGVpZ2h0OjEwMCU7d2lkdGg6MTAwJTtvdmVyZmxvdzpoaWRkZW59LmlubmVyR2FsbGVyeUNvbnRhaW5lciBpbWc6bGFzdC1jaGlsZHttYXJnaW4tcmlnaHQ6LTFweCFpbXBvcnRhbnR9LmdhbGxlcnlDb250YWluZXIgaW1nOmhvdmVyey13ZWJraXQtZmlsdGVyOmJyaWdodG5lc3MoNTAlKTtmaWx0ZXI6YnJpZ2h0bmVzcyg1MCUpO3RyYW5zaXRpb246YWxsIGVhc2Utb3V0IC4ycztjdXJzb3I6cG9pbnRlcn0uaW1hZ2Vyb3d7bWFyZ2luLXJpZ2h0OjFweDtvdmVyZmxvdzpoaWRkZW47ZGlzcGxheTpmbGV4fTo6LXdlYmtpdC1zY3JvbGxiYXJ7ZGlzcGxheTpub25lfS5hc3luY0xvYWRpbmdDb250YWluZXJ7cG9zaXRpb246YWJzb2x1dGU7YmFja2dyb3VuZC1jb2xvcjp0cmFuc3BhcmVudDtoZWlnaHQ6MDt3aWR0aDowO2JvdHRvbToxMjBweH0ucGFnZXJDb250YWluZXJ7bWFyZ2luOjQwcHggYXV0bzt3aWR0aDoxODBweH0ucGFnZXJ7ZGlzcGxheTpibG9jaztoZWlnaHQ6NjBweH1AbWVkaWEgKG1heC13aWR0aDo3MDBweCl7LnBhZ2VyQ29udGFpbmVye21hcmdpbjo0MHB4IGF1dG87d2lkdGg6MTUwcHh9LnBhZ2Vye2Rpc3BsYXk6YmxvY2s7aGVpZ2h0OjQ1cHh9fS5wYWdlci5pbmFjdGl2ZXtvcGFjaXR5Oi4xNX0ucGFnZXIubGVmdHtmbG9hdDpsZWZ0fS5wYWdlci5yaWdodHtmbG9hdDpyaWdodH1gXVxufSlcbmV4cG9ydCBjbGFzcyBHYWxsZXJ5Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3ksIE9uQ2hhbmdlcyB7XG4gICAgZ2FsbGVyeTogQXJyYXk8YW55PiA9IFtdXG4gICAgaW1hZ2VEYXRhU3RhdGljUGF0aDogc3RyaW5nID0gJ2Fzc2V0cy9pbWcvZ2FsbGVyeS8nXG4gICAgaW1hZ2VEYXRhQ29tcGxldGVQYXRoOiBzdHJpbmcgPSAnJ1xuICAgIGRhdGFGaWxlTmFtZTogc3RyaW5nID0gJ2RhdGEuanNvbidcbiAgICBpbWFnZXM6IEFycmF5PGFueT4gPSBbXVxuICAgIG1pbmltYWxRdWFsaXR5Q2F0ZWdvcnkgPSAncHJldmlld194eHMnXG4gICAgdmlld2VyU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb25cbiAgICByb3dJbmRleDogbnVtYmVyID0gMFxuICAgIHJpZ2h0QXJyb3dJbmFjdGl2ZTogYm9vbGVhbiA9IGZhbHNlXG4gICAgbGVmdEFycm93SW5hY3RpdmU6IGJvb2xlYW4gPSBmYWxzZVxuXG4gICAgQElucHV0KCdmbGV4Qm9yZGVyU2l6ZScpIHByb3ZpZGVkSW1hZ2VNYXJnaW46IG51bWJlciA9IDNcbiAgICBASW5wdXQoJ2ZsZXhJbWFnZVNpemUnKSBwcm92aWRlZEltYWdlU2l6ZTogbnVtYmVyID0gN1xuICAgIEBJbnB1dCgnZ2FsbGVyeU5hbWUnKSBwcm92aWRlZEdhbGxlcnlOYW1lOiBzdHJpbmcgPSAnJ1xuICAgIEBJbnB1dCgnbWV0YWRhdGFVcmknKSBwcm92aWRlZE1ldGFkYXRhVXJpOiBzdHJpbmcgPSB1bmRlZmluZWRcbiAgICBASW5wdXQoJ21heFJvd3NQZXJQYWdlJykgcm93c1BlclBhZ2U6IG51bWJlciA9IDIwMFxuXG4gICAgQE91dHB1dCgpIHZpZXdlckNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4oKVxuXG4gICAgQFZpZXdDaGlsZCgnZ2FsbGVyeUNvbnRhaW5lcicpIGdhbGxlcnlDb250YWluZXI6IEVsZW1lbnRSZWZcbiAgICBAVmlld0NoaWxkcmVuKCdpbWFnZUVsZW1lbnQnKSBpbWFnZUVsZW1lbnRzOiBRdWVyeUxpc3Q8YW55PlxuXG4gICAgQEhvc3RMaXN0ZW5lcignd2luZG93OnNjcm9sbCcsIFsnJGV2ZW50J10pIHRyaWdnZXJDeWNsZShldmVudDogYW55KTogdm9pZCB7XG4gICAgICAgIHRoaXMuc2NhbGVHYWxsZXJ5KClcbiAgICB9XG5cbiAgICBASG9zdExpc3RlbmVyKCd3aW5kb3c6cmVzaXplJywgWyckZXZlbnQnXSkgd2luZG93UmVzaXplKGV2ZW50OiBhbnkpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5yZW5kZXIoKVxuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBpbWFnZVNlcnZpY2U6IEltYWdlU2VydmljZSwgcHVibGljIGh0dHA6IEh0dHBDbGllbnQsIHB1YmxpYyBjaGFuZ2VEZXRlY3RvclJlZjogQ2hhbmdlRGV0ZWN0b3JSZWYpIHtcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5mZXRjaERhdGFBbmRSZW5kZXIoKVxuICAgICAgICB0aGlzLnZpZXdlclN1YnNjcmlwdGlvbiA9IHRoaXMuaW1hZ2VTZXJ2aWNlLnNob3dJbWFnZVZpZXdlckNoYW5nZWQkXG4gICAgICAgICAgICAuc3Vic2NyaWJlKCh2aXNpYmlsaXR5OiBib29sZWFuKSA9PiB0aGlzLnZpZXdlckNoYW5nZS5lbWl0KHZpc2liaWxpdHkpKVxuICAgIH1cblxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcbiAgICAgICAgLy8gaW5wdXQgcGFyYW1zIGNoYW5nZWRcbiAgICAgICAgaWYgKGNoYW5nZXNbJ3Byb3ZpZGVkR2FsbGVyeU5hbWUnXSAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZmV0Y2hEYXRhQW5kUmVuZGVyKClcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyKClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy52aWV3ZXJTdWJzY3JpcHRpb24pIHtcbiAgICAgICAgICAgIHRoaXMudmlld2VyU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9wZW5JbWFnZVZpZXdlcihpbWc6IGFueSk6IHZvaWQge1xuICAgICAgICB0aGlzLmltYWdlU2VydmljZS51cGRhdGVJbWFnZXModGhpcy5pbWFnZXMpXG4gICAgICAgIHRoaXMuaW1hZ2VTZXJ2aWNlLnVwZGF0ZVNlbGVjdGVkSW1hZ2VJbmRleCh0aGlzLmltYWdlcy5pbmRleE9mKGltZykpXG4gICAgICAgIHRoaXMuaW1hZ2VTZXJ2aWNlLnNob3dJbWFnZVZpZXdlcih0cnVlKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIGRpcmVjdGlvbiAoLTE6IGxlZnQsIDE6IHJpZ2h0KVxuICAgICAqL1xuICAgIG5hdmlnYXRlKGRpcmVjdGlvbjogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIGlmICgoZGlyZWN0aW9uID09PSAxICYmIHRoaXMucm93SW5kZXggPCB0aGlzLmdhbGxlcnkubGVuZ3RoIC0gdGhpcy5yb3dzUGVyUGFnZSlcbiAgICAgICAgICAgIHx8IChkaXJlY3Rpb24gPT09IC0xICYmIHRoaXMucm93SW5kZXggPiAwKSkge1xuICAgICAgICAgICAgdGhpcy5yb3dJbmRleCArPSAodGhpcy5yb3dzUGVyUGFnZSAqIGRpcmVjdGlvbilcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJlZnJlc2hOYXZpZ2F0aW9uRXJyb3JTdGF0ZSgpXG4gICAgfVxuXG4gICAgY2FsY0ltYWdlTWFyZ2luKCk6IG51bWJlciB7XG4gICAgICAgIGNvbnN0IGdhbGxlcnlXaWR0aCA9IHRoaXMuZ2V0R2FsbGVyeVdpZHRoKClcbiAgICAgICAgY29uc3QgcmF0aW8gPSBnYWxsZXJ5V2lkdGggLyAxOTIwXG4gICAgICAgIHJldHVybiBNYXRoLnJvdW5kKE1hdGgubWF4KDEsIHRoaXMucHJvdmlkZWRJbWFnZU1hcmdpbiAqIHJhdGlvKSlcbiAgICB9XG5cbiAgICBwcml2YXRlIGZldGNoRGF0YUFuZFJlbmRlcigpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5pbWFnZURhdGFDb21wbGV0ZVBhdGggPSB0aGlzLnByb3ZpZGVkTWV0YWRhdGFVcmlcblxuICAgICAgICBpZiAoIXRoaXMucHJvdmlkZWRNZXRhZGF0YVVyaSkge1xuICAgICAgICAgICAgdGhpcy5pbWFnZURhdGFDb21wbGV0ZVBhdGggPSB0aGlzLnByb3ZpZGVkR2FsbGVyeU5hbWUgIT09ICcnID9cbiAgICAgICAgICAgICAgICBgJHt0aGlzLmltYWdlRGF0YVN0YXRpY1BhdGggKyB0aGlzLnByb3ZpZGVkR2FsbGVyeU5hbWV9LyR7dGhpcy5kYXRhRmlsZU5hbWV9YCA6XG4gICAgICAgICAgICAgICAgdGhpcy5pbWFnZURhdGFTdGF0aWNQYXRoICsgdGhpcy5kYXRhRmlsZU5hbWVcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuaHR0cC5nZXQodGhpcy5pbWFnZURhdGFDb21wbGV0ZVBhdGgpXG4gICAgICAgICAgLnN1YnNjcmliZShcbiAgICAgICAgICAgIChkYXRhOiBBcnJheTxhbnk+KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW1hZ2VzID0gZGF0YVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmltYWdlU2VydmljZS51cGRhdGVJbWFnZXModGhpcy5pbWFnZXMpXG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbWFnZXMuZm9yRWFjaChpbWFnZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgaW1hZ2VbJ2dhbGxlcnlJbWFnZUxvYWRlZCddID0gZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICBpbWFnZVsndmlld2VySW1hZ2VMb2FkZWQnXSA9IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgaW1hZ2VbJ3NyY0FmdGVyRm9jdXMnXSA9ICcnXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC8vIHR3aWNlLCBzaW5nbGUgbGVhZHMgdG8gZGlmZmVyZW50IHN0cmFuZ2UgYnJvd3NlciBiZWhhdmlvdXJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIoKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcigpXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgZXJyID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucHJvdmlkZWRNZXRhZGF0YVVyaSkge1xuICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFByb3ZpZGVkIGVuZHBvaW50ICcke3RoaXMucHJvdmlkZWRNZXRhZGF0YVVyaX0nIGRpZCBub3Qgc2VydmUgbWV0YWRhdGEgY29ycmVjdGx5IG9yIGluIHRoZSBleHBlY3RlZCBmb3JtYXQuXG4gICAgICBTZWUgaGVyZSBmb3IgbW9yZSBpbmZvcm1hdGlvbjogaHR0cHM6Ly9naXRodWIuY29tL0JlbmphbWluQnJhbmRtZWllci9hbmd1bGFyMi1pbWFnZS1nYWxsZXJ5L2Jsb2IvbWFzdGVyL2RvY3MvZXh0ZXJuYWxEYXRhU291cmNlLm1kLFxuICAgICAgT3JpZ2luYWwgZXJyb3I6ICR7ZXJyfWApXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBEaWQgeW91IHJ1biB0aGUgY29udmVydCBzY3JpcHQgZnJvbSBhbmd1bGFyMi1pbWFnZS1nYWxsZXJ5IGZvciB5b3VyIGltYWdlcyBmaXJzdD8gT3JpZ2luYWwgZXJyb3I6ICR7ZXJyfWApXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICgpID0+IHVuZGVmaW5lZClcbiAgICB9XG5cbiAgICBwcml2YXRlIHJlbmRlcigpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5nYWxsZXJ5ID0gW11cblxuICAgICAgICBsZXQgdGVtcFJvdyA9IFt0aGlzLmltYWdlc1swXV1cbiAgICAgICAgbGV0IGN1cnJlbnRSb3dJbmRleCA9IDBcbiAgICAgICAgbGV0IGkgPSAwXG5cbiAgICAgICAgZm9yIChpOyBpIDwgdGhpcy5pbWFnZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHdoaWxlICh0aGlzLmltYWdlc1tpICsgMV0gJiYgdGhpcy5zaG91bGRBZGRDYW5kaWRhdGUodGVtcFJvdywgdGhpcy5pbWFnZXNbaSArIDFdKSkge1xuICAgICAgICAgICAgICAgIGkrK1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuaW1hZ2VzW2kgKyAxXSkge1xuICAgICAgICAgICAgICAgIHRlbXBSb3cucG9wKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZ2FsbGVyeVtjdXJyZW50Um93SW5kZXgrK10gPSB0ZW1wUm93XG5cbiAgICAgICAgICAgIHRlbXBSb3cgPSBbdGhpcy5pbWFnZXNbaSArIDFdXVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zY2FsZUdhbGxlcnkoKVxuICAgIH1cblxuICAgIHByaXZhdGUgc2hvdWxkQWRkQ2FuZGlkYXRlKGltZ1JvdzogQXJyYXk8YW55PiwgY2FuZGlkYXRlOiBhbnkpOiBib29sZWFuIHtcbiAgICAgICAgY29uc3Qgb2xkRGlmZmVyZW5jZSA9IHRoaXMuY2FsY0lkZWFsSGVpZ2h0KCkgLSB0aGlzLmNhbGNSb3dIZWlnaHQoaW1nUm93KVxuICAgICAgICBpbWdSb3cucHVzaChjYW5kaWRhdGUpXG4gICAgICAgIGNvbnN0IG5ld0RpZmZlcmVuY2UgPSB0aGlzLmNhbGNJZGVhbEhlaWdodCgpIC0gdGhpcy5jYWxjUm93SGVpZ2h0KGltZ1JvdylcblxuICAgICAgICByZXR1cm4gTWF0aC5hYnMob2xkRGlmZmVyZW5jZSkgPiBNYXRoLmFicyhuZXdEaWZmZXJlbmNlKVxuICAgIH1cblxuICAgIHByaXZhdGUgY2FsY1Jvd0hlaWdodChpbWdSb3c6IEFycmF5PGFueT4pOiBudW1iZXIge1xuICAgICAgICBjb25zdCBvcmlnaW5hbFJvd1dpZHRoID0gdGhpcy5jYWxjT3JpZ2luYWxSb3dXaWR0aChpbWdSb3cpXG5cbiAgICAgICAgY29uc3QgcmF0aW8gPSAodGhpcy5nZXRHYWxsZXJ5V2lkdGgoKSAtIChpbWdSb3cubGVuZ3RoIC0gMSkgKiB0aGlzLmNhbGNJbWFnZU1hcmdpbigpKSAvIG9yaWdpbmFsUm93V2lkdGhcbiAgICAgICAgY29uc3Qgcm93SGVpZ2h0ID0gaW1nUm93WzBdW3RoaXMubWluaW1hbFF1YWxpdHlDYXRlZ29yeV1bJ2hlaWdodCddICogcmF0aW9cblxuICAgICAgICByZXR1cm4gcm93SGVpZ2h0XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjYWxjT3JpZ2luYWxSb3dXaWR0aChpbWdSb3c6IEFycmF5PGFueT4pOiBudW1iZXIge1xuICAgICAgICBsZXQgb3JpZ2luYWxSb3dXaWR0aCA9IDBcbiAgICAgICAgaW1nUm93LmZvckVhY2goaW1nID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGluZGl2aWR1YWxSYXRpbyA9IHRoaXMuY2FsY0lkZWFsSGVpZ2h0KCkgLyBpbWdbdGhpcy5taW5pbWFsUXVhbGl0eUNhdGVnb3J5XVsnaGVpZ2h0J11cbiAgICAgICAgICAgIGltZ1t0aGlzLm1pbmltYWxRdWFsaXR5Q2F0ZWdvcnldWyd3aWR0aCddID0gaW1nW3RoaXMubWluaW1hbFF1YWxpdHlDYXRlZ29yeV1bJ3dpZHRoJ10gKiBpbmRpdmlkdWFsUmF0aW9cbiAgICAgICAgICAgIGltZ1t0aGlzLm1pbmltYWxRdWFsaXR5Q2F0ZWdvcnldWydoZWlnaHQnXSA9IHRoaXMuY2FsY0lkZWFsSGVpZ2h0KClcbiAgICAgICAgICAgIG9yaWdpbmFsUm93V2lkdGggKz0gaW1nW3RoaXMubWluaW1hbFF1YWxpdHlDYXRlZ29yeV1bJ3dpZHRoJ11cbiAgICAgICAgfSlcblxuICAgICAgICByZXR1cm4gb3JpZ2luYWxSb3dXaWR0aFxuICAgIH1cblxuICAgIHByaXZhdGUgY2FsY0lkZWFsSGVpZ2h0KCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldEdhbGxlcnlXaWR0aCgpIC8gKDgwIC8gdGhpcy5wcm92aWRlZEltYWdlU2l6ZSkgKyAxMDBcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldEdhbGxlcnlXaWR0aCgpOiBudW1iZXIge1xuICAgICAgICBpZiAodGhpcy5nYWxsZXJ5Q29udGFpbmVyLm5hdGl2ZUVsZW1lbnQuY2xpZW50V2lkdGggPT09IDApIHtcbiAgICAgICAgICAgIC8vIGZvciBJRTExXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nYWxsZXJ5Q29udGFpbmVyLm5hdGl2ZUVsZW1lbnQuc2Nyb2xsV2lkdGhcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5nYWxsZXJ5Q29udGFpbmVyLm5hdGl2ZUVsZW1lbnQuY2xpZW50V2lkdGhcbiAgICB9XG5cbiAgICBwcml2YXRlIHNjYWxlR2FsbGVyeSgpOiB2b2lkIHtcbiAgICAgICAgbGV0IGltYWdlQ291bnRlciA9IDBcbiAgICAgICAgbGV0IG1heGltdW1HYWxsZXJ5SW1hZ2VIZWlnaHQgPSAwXG5cbiAgICAgICAgdGhpcy5nYWxsZXJ5LnNsaWNlKHRoaXMucm93SW5kZXgsIHRoaXMucm93SW5kZXggKyB0aGlzLnJvd3NQZXJQYWdlKVxuICAgICAgICAgIC5mb3JFYWNoKGltZ1JvdyA9PiB7XG4gICAgICAgICAgICBjb25zdCBvcmlnaW5hbFJvd1dpZHRoID0gdGhpcy5jYWxjT3JpZ2luYWxSb3dXaWR0aChpbWdSb3cpXG5cbiAgICAgICAgICAgIGlmIChpbWdSb3cgIT09IHRoaXMuZ2FsbGVyeVt0aGlzLmdhbGxlcnkubGVuZ3RoIC0gMV0pIHtcbiAgICAgICAgICAgICAgICBjb25zdCByYXRpbyA9ICh0aGlzLmdldEdhbGxlcnlXaWR0aCgpIC0gKGltZ1Jvdy5sZW5ndGggLSAxKSAqIHRoaXMuY2FsY0ltYWdlTWFyZ2luKCkpIC8gb3JpZ2luYWxSb3dXaWR0aFxuXG4gICAgICAgICAgICAgICAgaW1nUm93LmZvckVhY2goKGltZzogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGltZ1snd2lkdGgnXSA9IGltZ1t0aGlzLm1pbmltYWxRdWFsaXR5Q2F0ZWdvcnldWyd3aWR0aCddICogcmF0aW9cbiAgICAgICAgICAgICAgICAgICAgaW1nWydoZWlnaHQnXSA9IGltZ1t0aGlzLm1pbmltYWxRdWFsaXR5Q2F0ZWdvcnldWydoZWlnaHQnXSAqIHJhdGlvXG4gICAgICAgICAgICAgICAgICAgIG1heGltdW1HYWxsZXJ5SW1hZ2VIZWlnaHQgPSBNYXRoLm1heChtYXhpbXVtR2FsbGVyeUltYWdlSGVpZ2h0LCBpbWdbJ2hlaWdodCddKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNoZWNrRm9yQXN5bmNMb2FkaW5nKGltZywgaW1hZ2VDb3VudGVyKyspXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaW1nUm93LmZvckVhY2goKGltZzogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGltZy53aWR0aCA9IGltZ1t0aGlzLm1pbmltYWxRdWFsaXR5Q2F0ZWdvcnldWyd3aWR0aCddXG4gICAgICAgICAgICAgICAgICAgIGltZy5oZWlnaHQgPSBpbWdbdGhpcy5taW5pbWFsUXVhbGl0eUNhdGVnb3J5XVsnaGVpZ2h0J11cbiAgICAgICAgICAgICAgICAgICAgbWF4aW11bUdhbGxlcnlJbWFnZUhlaWdodCA9IE1hdGgubWF4KG1heGltdW1HYWxsZXJ5SW1hZ2VIZWlnaHQsIGltZ1snaGVpZ2h0J10pXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tGb3JBc3luY0xvYWRpbmcoaW1nLCBpbWFnZUNvdW50ZXIrKylcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuXG4gICAgICAgIHRoaXMubWluaW1hbFF1YWxpdHlDYXRlZ29yeSA9IG1heGltdW1HYWxsZXJ5SW1hZ2VIZWlnaHQgPiAzNzUgPyAncHJldmlld194cycgOiAncHJldmlld194eHMnXG4gICAgICAgIHRoaXMucmVmcmVzaE5hdmlnYXRpb25FcnJvclN0YXRlKClcblxuICAgICAgICB0aGlzLmNoYW5nZURldGVjdG9yUmVmLmRldGVjdENoYW5nZXMoKVxuICAgIH1cblxuICAgIHByaXZhdGUgY2hlY2tGb3JBc3luY0xvYWRpbmcoaW1hZ2U6IGFueSwgaW1hZ2VDb3VudGVyOiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgaW1hZ2VFbGVtZW50cyA9IHRoaXMuaW1hZ2VFbGVtZW50cy50b0FycmF5KClcblxuICAgICAgICBpZiAoaW1hZ2VbJ2dhbGxlcnlJbWFnZUxvYWRlZCddIHx8XG4gICAgICAgICAgICAoaW1hZ2VFbGVtZW50cy5sZW5ndGggPiAwICYmXG4gICAgICAgICAgICAgIGltYWdlRWxlbWVudHNbaW1hZ2VDb3VudGVyXSAmJlxuICAgICAgICAgICAgICB0aGlzLmlzU2Nyb2xsZWRJbnRvVmlldyhpbWFnZUVsZW1lbnRzW2ltYWdlQ291bnRlcl0ubmF0aXZlRWxlbWVudCkpKSB7XG4gICAgICAgICAgICBpbWFnZVsnZ2FsbGVyeUltYWdlTG9hZGVkJ10gPSB0cnVlXG4gICAgICAgICAgICBpbWFnZVsnc3JjQWZ0ZXJGb2N1cyddID0gaW1hZ2VbdGhpcy5taW5pbWFsUXVhbGl0eUNhdGVnb3J5XVsncGF0aCddXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpbWFnZVsnc3JjQWZ0ZXJGb2N1cyddID0gJydcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgaXNTY3JvbGxlZEludG9WaWV3KGVsZW1lbnQ6IGFueSk6IGJvb2xlYW4ge1xuICAgICAgICBjb25zdCBlbGVtZW50VG9wID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3BcbiAgICAgICAgY29uc3QgZWxlbWVudEJvdHRvbSA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuYm90dG9tXG5cbiAgICAgICAgcmV0dXJuIGVsZW1lbnRUb3AgPCB3aW5kb3cuaW5uZXJIZWlnaHQgJiYgZWxlbWVudEJvdHRvbSA+PSAwICYmIChlbGVtZW50Qm90dG9tID4gMCB8fCBlbGVtZW50VG9wID4gMClcbiAgICB9XG5cbiAgICBwcml2YXRlIHJlZnJlc2hOYXZpZ2F0aW9uRXJyb3JTdGF0ZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5sZWZ0QXJyb3dJbmFjdGl2ZSA9IHRoaXMucm93SW5kZXggPT0gMFxuICAgICAgICB0aGlzLnJpZ2h0QXJyb3dJbmFjdGl2ZSA9IHRoaXMucm93SW5kZXggPiAodGhpcy5nYWxsZXJ5Lmxlbmd0aCAtIHRoaXMucm93c1BlclBhZ2UpXG4gICAgfVxufVxuIl19